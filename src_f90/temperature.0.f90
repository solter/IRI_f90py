!**********************************************************
!***************** ELECTRON TEMPERATURE ********************
!**********************************************************
!
SUBROUTINE ELTEIK(PF107Y,INVDIP,MLT,ALT,DDD,PF107,TE,SIGTE)
    !      SUBROUTINE ELTEIK(CRD,PF107Y,INVDIP,FL,DIMO,B0,
    !                         DIPL,MLT,ALT,DDD,PF107,TE,SIGTE)
    !----------------------------------------------------------------------
    ! Empirical model of electron temperature (Te) in the outer ionosphere
    ! with inclusion of solar activity.
    ! Based on spherical harmonics approximation of measured
    ! Te (all available satellites) at altitudes centred on 350km, 550km,
    ! 850km, 1400km, and 2000km. For intermediate altitudes a linear
    ! interpolation is used. Recommended altitude range: 300-2500 km!!!
    ! Linear extrapolation is used for altitude ranges <300;350)km
    ! and (2000;2500> km. For days between seasons centred at
    ! (21.3. = 79; 21.6. = 171; 23.9. 265; 21.12. = 354) Te is
    ! interpolated by a harmonic function.
    !c Inputs: CRD - 0 .. INVDIP
    !c               1 .. FL, DIMO, B0, DIPL (used for calc. INVDIP inside)
    !         PF107Y - 0 .. PF107 correction NOT included
    !                  1 .. PF107 correction included
    !         INVDIP - "mix" coordinate of the dip latitude and of
    !                the invariant latitude (can be computed with INVDPC)
    !                positive northward, in deg, range <-90.0;90.0>
    !c         FL, DIMO, BO - McIlwain L parameter, dipole moment in
    !c                        Gauss, magnetic field strength in Gauss -
    !c                        parameters needed for invariant latitude
    !c                        calculation
    !c         DIPL - dip latitude
    !c                positive northward, in deg, range <-90.0;90.0>
    !         MLT - magnetic local time (central dipole)
    !               in hours, range <0;24)
    !         ALT - altitude above the Earth's surface;
    !               in km, range <500;3000>
    !         DDD - day of year; range <0;365>
    !         PF107 - Phil Richard's solar radio flux;
    ! Output: TE - electron temperature in K
    !         SIGTE - standard deviation (or model error) of TE in K
    ! Versions: 1.00 (IDL) the first version Te=Te(invl,mlt,alt,season)
    !           1.50 (IDL) corrected IK19 Te at 900km for possible Ne>2E11 m-3
    !           2.00 (IDL) F107 included as a linear perturbation on global Te pattern
    !                      Te=Te(invlat,mlt,alt,season,F107)
    !           3.00 (IDL) invdipl introduced
    !           2000 (IDL,FORTRAN) correction for seasons included
    !           2010 (IDL,FORTRAN) completely new version
    ! Authors of the model (v 2011)
    !                V. Truhlik, D. Bilitza, and L. Triskova
    ! Author of the code:
    !         Vladimir Truhlik
    !         Institute of Atm. Phys.
    !         Bocni II.
    !         141 31 Praha 4, Sporilov
    !         Czech Republic
    !         e-mail: vtr@ufa.cas.cz
    !----------------------------------------------------------------------
    !      REAL INVDIP,FL,DIMO,B0,DIPL,MLT,ALT,PF107,TE,SIGTE
    !      INTEGER CRD,PF107Y,DDD,SEZDAY,XDAY
    REAL INVDIP,MLT,ALT,PF107,TE,SIGTE
    INTEGER PF107Y,DDD,SEZDAY,XDAY
    INTEGER MIRREQ(81)
    REAL D(5,3,81),DERRTE(5,3,81),DPF107(5,3,81)
    DOUBLE PRECISION B(8),A
    REAL DPI,DTOR,ASA,INVL,RINVL,INVDP,RDIPL,ALFA,BETA
    REAL RMLT,RCOLAT
    REAL C(82)
    INTEGER SEZA,SEZB,DDDA,DDDB,DDDD
    REAL T350,T350A,T350B,T550,T550A,T550B,T850,T850A,T850B,&
        T1400,T1400A,T1400B,T2000,T2000A,T2000B
    REAL P350A,P350B,P550A,P550B,P850A,P850B,&
        P1400A,P1400B,P2000A,P2000B
    REAL E350,E350A,E350B,E550,E550A,E550B,E850,E850A,E850B,&
        E1400,E1400A,E1400B,E2000,E2000A,E2000B
    REAL TP350A,TP350B,TP550A,TP550B,TP850A,TP850B,&
        TP140A,TP140B,TP200A,TP200B
    INTEGER FUN
    INTEGER I
    DATA B/1.259921D0  ,-0.1984259D0 ,-0.04686632D0,-0.01314096D0,&
        -0.00308824D0, 0.00082777D0,-0.00105877D0, 0.00183142D0/
    !////////////////////////////////coefficients - main model part//////////////////////
    DATA (MIRREQ(J),J=1,81)/&
        1,-1, 1,-1, 1,-1, 1,-1, 1, 1,-1, 1,-1, 1,-1, 1,-1, 1,-1, 1,-1,&
        1,-1, 1,-1, 1,-1, 1,-1, 1,-1, 1, 1,-1, 1,-1, 1,-1, 1, 1,-1, 1,&
        -1, 1,-1, 1,-1, 1,-1, 1,-1, 1,-1, 1,-1, 1, 1,-1, 1,-1, 1, 1,-1,&
        1,-1, 1,-1, 1,-1, 1,-1, 1, 1,-1, 1, 1,-1, 1,-1, 1, 1/
    CALL KOEFD(MIRREQ,D)
    CALL KODERR(MIRREQ,DERRTE)
    CALL KOF107(MIRREQ,DPF107)
    !//////////////////////thresholds of solar activity/////////////////////////////////////
    IF (PF107  >  250) PF107=250
    IF (PF107  <  80) PF107=80
    !////////////////////////////////////////////////////////////////////////////////////
    DPI=3.1415926535897
    DTOR=DPI/180.0
    !      IF (CRD  ==  1) THEN
    !      calculation of INVDIP from FL, DIMO, BO, and DIPL
    !      invariant latitude calculated by highly
    !      accurate polynomial expansion
    !       A=(DIMO/B0)**(1.0D0/3.0D0)/FL
    !       ASA=A*(B(1)+B(2)*A+B(3)*A**2+B(4)*A**3+B(5)*A**4+
    !              B(6)*A**5+B(7)*A**6+B(8)*A**7)
    !       IF (ASA  >  1.0) ASA=1.0
    !       IF (ASA  <  0.0) ASA=0.0
    !      invariant latitude (absolute value)
    !       RINVL=ACOS(SQRT(ASA))
    !       INVL=RINVL/DTOR
    !       RDIPL=DIPL*DTOR
    !       ALFA=SIN(ABS(RDIPL))**3
    !       BETA=COS(RINVL)**3
    !       INVDP=(ALFA*SIGN(1.0,DIPL)*INVL+BETA*DIPL)/(ALFA+BETA)
    !      ELSE IF    (CRD  ==  0) THEN
    !       INVDP=INVDIP
    !      ELSE
    !       RETURN
    !      END IF
    INVDP=INVDIP
    RMLT=MLT*DTOR*15.0
    RCOLAT=(90.0-INVDP)*DTOR
    CALL SPHARM_IK(C,8,8,RCOLAT,RMLT)
    !     21.3. - 20.6.
    IF ((DDD  >=  79) .AND. (DDD  <  171)) THEN
        SEZA=1
        SEZB=2
        DDDA=79
        DDDB=171
        DDDD=DDD
        FUN=0
    END IF
    !     21.6. - 22.9.
    IF ((DDD  >=  171) .AND. (DDD  <  265)) THEN
        SEZA=2
        SEZB=1
        DDDA=171
        DDDB=265
        DDDD=DDD
        FUN=1
    END IF
    !     23.9. - 20.12.
    IF ((DDD  >=  265) .AND. (DDD  <  354)) THEN
        SEZA=1
        SEZB=3
        DDDA=265
        DDDB=354
        DDDD=DDD
        FUN=0
    END IF
    !     21.12. - 20.3.
    IF ((DDD  >=  354) .OR. (DDD  <  79)) THEN
        SEZA=3
        SEZB=1
        DDDA=354
        DDDB=365+79
        DDDD=DDD
        IF (DDD  >=  354) THEN
            DDDD=DDD
        ELSE
            DDDD=DDD+365
        END IF
        FUN=1
    END IF
    !     model Te
    T350A=0.0
    T350B=0.0
    T550A=0.0
    T550B=0.0
    T850A=0.0
    T850B=0.0
    T1400A=0.0
    T1400B=0.0
    T2000A=0.0
    T2000B=0.0
    DO  I=1,81
        T350A=T350A+C(I)*D(1,SEZA,I)
        T350B=T350B+C(I)*D(1,SEZB,I)
        T550A=T550A+C(I)*D(2,SEZA,I)
        T550B=T550B+C(I)*D(2,SEZB,I)
        T850A=T850A+C(I)*D(3,SEZA,I)
        T850B=T850B+C(I)*D(3,SEZB,I)
        T1400A=T1400A+C(I)*D(4,SEZA,I)
        T1400B=T1400B+C(I)*D(4,SEZB,I)
        T2000A=T2000A+C(I)*D(5,SEZA,I)
        T2000B=T2000B+C(I)*D(5,SEZB,I)
    end do
    T350A=10**T350A
    T350B=10**T350B
    T550A=10**T550A
    T550B=10**T550B
    T850A=10**T850A
    T850B=10**T850B
    T1400A=10**T1400A
    T1400B=10**T1400B
    T2000A=10**T2000A
    T2000B=10**T2000B
    !     model PF107
    P350A=0.0
    P350B=0.0
    P550A=0.0
    P550B=0.0
    P850A=0.0
    P850B=0.0
    P1400A=0.0
    P1400B=0.0
    P2000A=0.0
    P2000B=0.0
    DO I=1,81
        P350A=P350A+C(I)*DPF107(1,SEZA,I)
        P350B=P350B+C(I)*DPF107(1,SEZB,I)
        P550A=P550A+C(I)*DPF107(2,SEZA,I)
        P550B=P550B+C(I)*DPF107(2,SEZB,I)
        P850A=P850A+C(I)*DPF107(3,SEZA,I)
        P850B=P850B+C(I)*DPF107(3,SEZB,I)
        P1400A=P1400A+C(I)*DPF107(4,SEZA,I)
        P1400B=P1400B+C(I)*DPF107(4,SEZB,I)
        P2000A=P2000A+C(I)*DPF107(5,SEZA,I)
        P2000B=P2000B+C(I)*DPF107(5,SEZB,I)
    end do
    P350A=10**P350A
    P350B=10**P350B
    P550A=10**P550A
    P550B=10**P550B
    P850A=10**P850A
    P850B=10**P850B
    P1400A=10**P1400A
    P1400B=10**P1400B
    P2000A=10**P2000A
    P2000B=10**P2000B
    !     model errTe
    E350A=0.0
    E350B=0.0
    E550A=0.0
    E550B=0.0
    E850A=0.0
    E850B=0.0
    E1400A=0.0
    E1400B=0.0
    E2000A=0.0
    E2000B=0.0
    DO I=1,81
        E350A=E350A+C(I)*DERRTE(1,SEZA,I)
        E350B=E350B+C(I)*DERRTE(1,SEZB,I)
        E550A=E550A+C(I)*DERRTE(2,SEZA,I)
        E550B=E550B+C(I)*DERRTE(2,SEZB,I)
        E850A=E850A+C(I)*DERRTE(3,SEZA,I)
        E850B=E850B+C(I)*DERRTE(3,SEZB,I)
        E1400A=E1400A+C(I)*DERRTE(4,SEZA,I)
        E1400B=E1400B+C(I)*DERRTE(4,SEZB,I)
        E2000A=E2000A+C(I)*DERRTE(5,SEZA,I)
        E2000B=E2000B+C(I)*DERRTE(5,SEZB,I)
    end do
    E350A=10**E350A
    E350B=10**E350B
    E550A=10**E550A
    E550B=10**E550B
    E850A=10**E850A
    E850B=10**E850B
    E1400A=10**E1400A
    E1400B=10**E1400B
    E2000A=10**E2000A
    E2000B=10**E2000B
    !
    IF (PF107Y  ==  1) THEN
        CALL TPCORR(INVDP,MLT,DDD,PF107,&
            P350A,P350B,P550A,P550B,P850A,P850B,&
            P1400A,P1400B,P2000A,P2000B, &
            TP350A,TP350B,TP550A,TP550B,TP850A,TP850B,&
            TP140A,TP140B,TP200A,TP200B)
        T350A=T350A+TP350A
        T350B=T350B+TP350B
        T550A=T550A+TP550A
        T550B=T550B+TP550B
        T850A=T850A+TP850A
        T850B=T850B+TP850B
        T1400A=T1400A+TP140A
        T1400B=T1400B+TP140B
        T2000A=T2000A+TP200A
        T2000B=T2000B+TP200B
    END IF
    !     Te
    IF (FUN  ==  0) THEN
        SEZDAY=(DDDB-DDDA)
        XDAY=DDDD-DDDA
        T350=(T350B-T350A)*SIN(DPI/2.0*XDAY/SEZDAY)+T350A
        T550=(T550B-T550A)*SIN(DPI/2.0*XDAY/SEZDAY)+T550A
        T850=(T850B-T850A)*SIN(DPI/2.0*XDAY/SEZDAY)+T850A
        T1400=(T1400B-T1400A)*SIN(DPI/2.0*XDAY/SEZDAY)+T1400A
        T2000=(T2000B-T2000A)*SIN(DPI/2.0*XDAY/SEZDAY)+T2000A
    ELSE
        SEZDAY=(DDDB-DDDA)
        XDAY=DDDD-DDDA
        T350=(T350A-T350B)*COS(DPI/2.0*XDAY/SEZDAY)+T350B
        T550=(T550A-T550B)*COS(DPI/2.0*XDAY/SEZDAY)+T550B
        T850=(T850A-T850B)*COS(DPI/2.0*XDAY/SEZDAY)+T850B
        T1400=(T1400A-T1400B)*COS(DPI/2.0*XDAY/SEZDAY)+T1400B
        T2000=(T2000A-T2000B)*COS(DPI/2.0*XDAY/SEZDAY)+T2000B
    END IF
    !     error Te
    IF (FUN  ==  0) THEN
        SEZDAY=(DDDB-DDDA)
        XDAY=DDDD-DDDA
        E350=(E350B-E350A)*SIN(DPI/2.0*XDAY/SEZDAY)+E350A
        E550=(E550B-E550A)*SIN(DPI/2.0*XDAY/SEZDAY)+E550A
        E850=(E850B-E850A)*SIN(DPI/2.0*XDAY/SEZDAY)+E850A
        E1400=(E1400B-E1400A)*SIN(DPI/2.0*XDAY/SEZDAY)+E1400A
        E2000=(E2000B-E2000A)*SIN(DPI/2.0*XDAY/SEZDAY)+E2000A
    ELSE
        SEZDAY=(DDDB-DDDA)
        XDAY=DDDD-DDDA
        E350=(E350A-E350B)*COS(DPI/2.0*XDAY/SEZDAY)+E350B
        E550=(E550A-E550B)*COS(DPI/2.0*XDAY/SEZDAY)+E550B
        E850=(E850A-E850B)*COS(DPI/2.0*XDAY/SEZDAY)+E850B
        E1400=(E1400A-E1400B)*COS(DPI/2.0*XDAY/SEZDAY)+E1400B
        E2000=(E2000A-E2000B)*COS(DPI/2.0*XDAY/SEZDAY)+E2000B
    END IF
    ! ////////////////////////////////////////////////////////
    !     Te linear interpolation for altitude
    IF (ALT  <  550) THEN
        TE=(T550-T350)/200.0*(ALT-350)+T350
        SIGTE=(E550-E350)/200.0*(ALT-350)+E350
    END IF
    IF ((ALT  >=  550) .AND. (ALT  <  850)) THEN
        TE=(T850-T550)/300.0*(ALT-550)+T550
        SIGTE=(E850-E550)/300.0*(ALT-550)+E550
    END IF
    IF ((ALT  >=  850) .AND. (ALT  <  1400)) THEN
        TE=(T1400-T850)/550.0*(ALT-850)+T850
        SIGTE=(E1400-E850)/550.0*(ALT-850)+E850
    END IF
    IF (ALT  >=  1400) THEN
        TE=(T2000-T1400)/600.0*(ALT-1400)+T1400
        SIGTE=(E2000-E1400)/600.0*(ALT-1400)+E1400
    END IF

    INVDIP=INVDP

    RETURN
END
!
!
REAL FUNCTION INTERP(N,L,V,X,XOUT)
    !---------------------------------------------------------------------------------
    INTEGER N,L,S,S0,I
    REAL V(N),X(N),XOUT,Y2(N),YOUT,X0(4),V0(4)
    REAL XA,XB,XC,VA,VB,VC
    CALL locate(X,N,XOUT,S)
    IF (L  ==  0) THEN
        !       Spline interpolation (L=0)
        IF (S  <  2) S=2
        IF (S  >  (N-2)) S=N-2
        S0=S-1
        DO I=1,4
            X0(I)=X(S0+I-1)
            V0(I)=V(S0+I-1)
        end do
        CALL SPLINE(X0,V0,4,1e30,1e30,Y2)
        CALL SPLINT(X0,V0,Y2,4,XOUT,YOUT)
    END IF
    IF (L  ==  1) THEN
        !       Linear interpolation (L=1)
        IF ((S  >= 1) .AND. (S  <  N)) THEN
            YOUT=(V(S+1)-V(S))/(X(S+1)-X(S))*(XOUT-X(S))+V(S)
        END IF
        IF (S  ==  0) THEN
            YOUT=(V(2)-V(1))/(X(2)-X(1))*(XOUT-X(1))+V(1)
        END IF
        IF (S  ==  N) THEN
            YOUT=(V(N)-V(N-1))/(X(N)-X(N-1))*(XOUT-X(N))+V(N)
        END IF
    END IF
    IF (L  ==  2) THEN
        !       Quadratic interpolation (L=2)
        IF (S  <  2) S=2
        IF (S  >  (N-1)) S=N-1
        XA=X(S-1)
        XB=X(S)
        XC=X(S+1)
        VA=V(S-1)
        VB=V(S)
        VC=V(S+1)
        YOUT=VA*(XOUT-XB)*(XOUT-XC)/((XA-XB)*(XA-XC))+&
            VB*(XOUT-XA)*(XOUT-XC)/((XB-XA)*(XB-XC))+&
            VC*(XOUT-XA)*(XOUT-XB)/((XC-XA)*(XC-XB))
    END IF
    INTERP=YOUT
    RETURN
END
!
!
SUBROUTINE KODERR(MIRREQ,DOUT)
    !------------------------------------------------------------------------------------
    ! coefficients - error model part
    !------------------------------------------------------------------------------------
    REAL DOUT(5,3,81)
    INTEGER MIRREQ(81),I,J,K
    REAL DERRTE(5,3,81)
    !     350km equinox
    DATA (DERRTE(1,1,J),J=1,81)/ 2.1178E+00, 1.3114E-07, 2.6148E-01,&
        -2.8483E-07,-8.3770E-02,-2.3135E-08,&
        5.7835E-02,-9.9532E-08,-2.0735E-02,&
        -1.9633E-01, 4.4717E-08, 5.0244E-02,&
        -9.1274E-09, 4.8611E-02, 2.5790E-08,&
        1.2098E-02,-3.3205E-08, 6.4414E-02,&
        2.4963E-08, 2.6340E-03,-3.3202E-08,&
        1.0058E-02, 1.0816E-09,-1.3928E-02,&
        1.4163E-08,-1.5039E-01, 1.0533E-08,&
        -4.5060E-03, 8.3297E-09, 2.4488E-03,&
        -3.7760E-09,-1.8094E-03, 9.6798E-02,&
        -1.8772E-09, 1.0867E-02,-1.9474E-09,&
        -6.8032E-03, 3.3603E-09, 7.8251E-03,&
        1.6945E-01,-1.1341E-08,-2.0581E-02,&
        -1.9111E-09,-5.8315E-03,-5.3837E-11,&
        -3.5216E-02,-3.3668E-09, 1.1079E-03,&
        8.5225E-09, 4.8433E-03,-2.6840E-09,&
        9.9141E-02,-1.0567E-08, 1.8306E-03,&
        1.9576E-10, 1.5468E-03, 1.6529E-01,&
        -8.3743E-09,-1.0179E-02,-1.0826E-09,&
        -1.4207E-03,-4.8573E-02, 1.1394E-08,&
        1.4470E-02, 2.6626E-10, 9.4379E-02,&
        -1.8262E-08,-2.0741E-03, 1.3797E-09,&
        5.9985E-03, 1.8945E-10, 3.4170E-04,&
        6.8581E-02, 5.7838E-09, 6.9529E-03,&
        1.5896E-02,-5.0075E-09, 2.8420E-02,&
        -4.8417E-09, 2.9191E-02, 4.8866E-02/
    !     350km June solstice
    DATA (DERRTE(1,2,J),J=1,81)/ 2.1020E+00, 6.4074E-02, 8.8979E-02,&
        -1.6295E-01,-6.8680E-02,-4.9903E-02,&
        2.7634E-02, 5.3483E-02,-3.6534E-02,&
        -2.3004E-01, 5.3630E-02, 9.0376E-02,&
        2.6442E-02, 3.7594E-02, 1.7345E-02,&
        -4.3779E-02,-4.7004E-03, 9.0849E-02,&
        2.6102E-02,-3.2626E-02,-1.1288E-03,&
        2.4115E-02,-1.8059E-03,-3.9570E-03,&
        5.6676E-03,-6.3478E-02, 1.5132E-02,&
        3.1012E-02,-1.7904E-04,-1.7065E-04,&
        -6.6273E-03, 5.2600E-03,-1.5202E-01,&
        2.2061E-02, 1.0633E-02,-2.8630E-03,&
        -9.6908E-03,-1.3059E-03, 2.4577E-03,&
        9.1133E-02, 1.0057E-02, 7.1922E-04,&
        2.9878E-03, 7.7424E-04,-4.4353E-03,&
        -7.6271E-03, 1.4035E-02,-1.3870E-02,&
        1.6514E-03, 1.3885E-03, 7.7953E-04,&
        1.1731E-01, 2.3511E-02,-8.2554E-04,&
        -2.4741E-03, 1.5413E-04, 3.3407E-02,&
        -5.2112E-04,-6.3114E-03, 5.3990E-03,&
        -9.1618E-04, 1.1605E-02, 1.2671E-03,&
        -2.1350E-03, 2.6276E-03, 8.2348E-02,&
        -2.2401E-06,-1.4076E-03, 1.6459E-03,&
        -4.3340E-02, 1.4798E-02, 4.6935E-03,&
        3.0577E-02, 6.6725E-03, 9.0547E-03,&
        -1.5337E-02,-4.3676E-03,-6.5343E-02,&
        1.1111E-02, 2.3191E-03,-3.1603E-02/
    !     550km equinox
    DATA (DERRTE(2,1,J),J=1,81)/ 2.0812E+00, 2.4308E-07, 5.6584E-01,&
        1.9086E-08,-7.6095E-02,-5.1032E-07,&
        -1.7049E-01,-1.0472E-08, 6.7164E-02,&
        -2.2595E-01, 4.2122E-09, 6.1906E-03,&
        3.9518E-08, 4.5763E-02,-2.2074E-08,&
        -1.1397E-02,-1.0607E-08, 1.6385E-01,&
        4.4170E-08,-2.2410E-02,-1.5556E-08,&
        1.2078E-02,-2.9345E-08,-2.3789E-03,&
        5.0526E-08,-2.4343E-01, 1.6201E-08,&
        1.9976E-02,-2.2397E-11, 4.6519E-03,&
        -1.1324E-09,-2.2603E-03,-1.2091E-01,&
        6.5523E-09, 2.3472E-02, 1.2557E-10,&
        3.5617E-03, 2.1655E-09,-1.3878E-03,&
        -2.4845E-02,-3.1878E-09,-1.3496E-02,&
        3.2648E-09,-8.7088E-04,-3.2223E-09,&
        -8.9965E-02, 1.6719E-09, 5.9083E-03,&
        7.0153E-10, 6.3045E-06,-1.7459E-09,&
        1.1872E-01, 3.4154E-09, 8.3146E-03,&
        7.3305E-11,-1.5977E-04, 2.3161E-02,&
        1.6234E-09,-9.7428E-03,-3.1068E-10,&
        1.1073E-03, 6.8273E-02, 7.3145E-09,&
        4.3073E-03, 1.3123E-10, 1.7105E-02,&
        1.9378E-09,-1.6849E-03, 3.9189E-10,&
        1.4436E-02,-7.5937E-10, 5.5921E-04,&
        3.0434E-02,-5.3588E-10, 1.7285E-03,&
        -4.6172E-02, 1.0424E-09,-3.3645E-02,&
        4.5595E-10,-1.0524E-02,-6.6919E-02/
    !     550km June solstice
    DATA (DERRTE(2,2,J),J=1,81)/ 2.0903E+00, 4.9465E-02, 4.1834E-01,&
        -3.0721E-02,-1.0157E-01,-1.5666E-01,&
        -7.6741E-02, 1.2230E-01, 3.1210E-02,&
        -1.5269E-01, 4.5530E-02,-2.1376E-03,&
        -1.8327E-02, 2.3483E-02, 3.1872E-02,&
        -2.3882E-02,-1.4407E-02, 4.4489E-02,&
        1.4618E-02,-2.3584E-04,-6.5495E-03,&
        1.6602E-02,-7.5274E-03,-1.3698E-02,&
        -8.2527E-03,-2.1590E-01, 2.5813E-02,&
        5.0590E-02, 2.1022E-03, 1.0141E-02,&
        -5.1961E-03, 5.4961E-03, 9.7779E-03,&
        1.5319E-02,-1.0422E-02,-9.1045E-03,&
        -8.1248E-03,-5.5846E-03, 1.2857E-03,&
        -3.1836E-02,-4.4886E-03,-1.8187E-02,&
        -1.0253E-03,-4.4267E-04,-1.6932E-03,&
        -8.0883E-02, 2.2869E-02, 3.6385E-03,&
        6.0430E-03, 1.8587E-03,-1.5704E-03,&
        5.2741E-02, 2.3327E-03,-8.1670E-03,&
        2.3873E-03,-4.6541E-04,-5.5659E-02,&
        1.0942E-02,-1.0447E-02,-4.5905E-04,&
        2.9831E-04, 9.2199E-02,-8.8334E-03,&
        4.9657E-03,-1.2876E-03, 1.5785E-02,&
        -1.1838E-02,-2.4461E-04, 8.0350E-04,&
        8.4769E-03, 7.2212E-03, 1.2089E-03,&
        4.0519E-02,-8.4599E-03, 1.1588E-03,&
        -3.3485E-02, 5.8463E-03,-2.8652E-03,&
        8.8555E-03,-2.6834E-02,-5.0552E-02/
    !     850km equinox
    DATA (DERRTE(3,1,J),J=1,81)/ 2.1741E+00,-3.0713E-07, 7.0198E-02,&
        4.9868E-07,-1.4427E-01, 2.8235E-08,&
        2.9561E-02,-8.1150E-07, 1.8500E-03,&
        8.5103E-02, 3.3995E-09, 3.7822E-02,&
        4.4995E-08, 3.8160E-02, 6.1687E-09,&
        -7.6820E-03,-3.5958E-08, 5.4672E-02,&
        1.5964E-10, 1.6325E-02,-2.9809E-08,&
        -2.8099E-03, 2.0887E-08,-1.6249E-03,&
        6.0045E-09,-4.3312E-02, 1.2503E-08,&
        3.9802E-02, 1.6466E-08, 1.4980E-02,&
        -7.7490E-09, 4.3219E-03, 1.0214E-01,&
        -1.6204E-08, 8.0035E-03, 3.9310E-09,&
        -2.1047E-04,-2.0211E-10, 2.3744E-03,&
        -1.0833E-01,-2.6971E-09,-1.8076E-02,&
        3.9598E-09, 8.3868E-05,-1.0948E-10,&
        7.6547E-02, 1.1306E-09,-1.5295E-02,&
        -8.6391E-10,-9.3252E-04,-9.1719E-12,&
        6.3563E-02,-1.2694E-08,-6.3280E-03,&
        5.2632E-10,-7.9613E-04,-1.1528E-02,&
        1.0676E-08, 1.0950E-02,-5.2360E-09,&
        -1.0426E-03,-8.4653E-03, 2.7643E-09,&
        -1.0339E-03, 1.0439E-09, 8.2576E-02,&
        -1.0238E-08,-5.2244E-03,-2.8944E-10,&
        1.7164E-02,-3.7405E-09, 1.3255E-03,&
        -1.6994E-02, 4.5616E-09, 1.3458E-03,&
        2.5439E-02,-5.2198E-09, 3.0276E-02,&
        -3.3313E-09,-5.7659E-02, 2.8990E-02/
    !     850km June solstice
    DATA (DERRTE(3,2,J),J=1,81)/ 2.1685E+00,-9.1071E-02,-1.2046E-01,&
        -2.0084E-01,-7.3145E-02,-1.2735E-01,&
        -5.5899E-02, 5.2264E-02, 2.3232E-02,&
        2.8355E-02,-3.9715E-02, 6.7638E-02,&
        2.3396E-02,-8.2230E-03, 1.1384E-02,&
        -1.6781E-02,-1.7576E-03,-8.0253E-02,&
        -3.9270E-02,-1.0264E-02,-1.7191E-03,&
        -4.4668E-03,-1.2252E-04,-7.9374E-03,&
        2.3770E-03, 5.3901E-02,-1.9019E-03,&
        3.2748E-02, 8.1218E-03, 3.1385E-03,&
        6.5387E-03, 1.9147E-03, 9.6127E-02,&
        -2.7965E-02,-7.7649E-03, 3.7879E-03,&
        -4.0496E-03, 6.9544E-03,-5.2783E-04,&
        -1.5082E-01, 1.2699E-02,-1.2565E-03,&
        6.7728E-03, 3.6761E-03,-1.7899E-03,&
        -6.4801E-02,-1.7940E-02,-1.3257E-02,&
        5.2332E-03,-6.6084E-03,-2.9180E-03,&
        3.0122E-02, 2.1713E-02,-8.3407E-03,&
        1.1084E-03, 9.2082E-04,-8.5997E-02,&
        -1.4387E-02, 9.3689E-03, 6.2303E-04,&
        3.5905E-04, 1.7038E-02,-6.3187E-03,&
        3.6498E-03, 5.2909E-04,-7.0981E-03,&
        5.5184E-03, 6.6041E-04, 3.3276E-04,&
        6.9458E-02,-4.9348E-03, 6.0775E-03,&
        -5.0934E-02,-4.4936E-03, 1.3723E-03,&
        -8.1570E-03, 1.3748E-02, 7.0236E-03,&
        7.9914E-04,-4.6833E-02,-1.6385E-02/
    !     1400km equinox
    DATA (DERRTE(4,1,J),J=1,81)/ 2.1822E+00, 3.3549E-08, 1.2164E-01,&
        2.4764E-07,-8.7502E-02,-4.0691E-07,&
        2.3355E-03,-2.8158E-07,-1.3242E-03,&
        1.4782E-02, 1.5416E-08, 8.8183E-02,&
        2.7046E-08,-2.2398E-02,-4.4919E-09,&
        -7.8416E-03,-1.7223E-08,-1.3115E-02,&
        2.6125E-08, 5.3183E-02,-2.9019E-08,&
        -3.7068E-04, 5.4685E-10, 1.7274E-03,&
        1.8592E-08,-6.2685E-02,-5.3055E-09,&
        3.1005E-02, 1.7579E-09, 2.4121E-03,&
        4.4444E-11, 4.1500E-03,-2.4028E-01,&
        -2.3704E-08, 8.7659E-03, 4.2252E-09,&
        4.8969E-03, 4.0202E-10, 1.9055E-03,&
        -1.6350E-01, 3.2289E-09, 1.4824E-03,&
        -3.6081E-09, 1.3517E-03, 2.4239E-09,&
        -1.6658E-01, 1.0138E-09, 1.3305E-02,&
        4.1669E-09, 1.8869E-03,-2.0831E-09,&
        2.0076E-02,-1.0135E-08, 2.2258E-03,&
        -1.2563E-09,-1.3067E-03,-1.8645E-01,&
        2.1705E-09,-7.8197E-03,-9.9205E-10,&
        9.4107E-04, 1.7436E-01,-2.0898E-09,&
        7.8659E-03, 2.7303E-10, 7.1875E-02,&
        -2.0799E-09,-3.6387E-03, 2.5309E-09,&
        -9.2385E-02, 1.1905E-09, 2.6655E-03,&
        -2.4122E-02, 6.0810E-10, 5.8355E-03,&
        -5.1302E-02,-7.9405E-09,-7.6189E-02,&
        -6.7824E-10,-3.1716E-02,-4.1055E-02/
    !     1400km June solstice
    DATA (DERRTE(4,2,J),J=1,81)/ 2.1442E+00,-1.3864E-01, 1.7112E-01,&
        -2.1389E-01,-1.8186E-02,-1.0237E-01,&
        5.9302E-02, 6.0929E-02, 2.4732E-02,&
        7.8690E-02,-2.1925E-02, 1.2199E-01,&
        -2.8987E-02,-5.3213E-02,-4.8915E-03,&
        4.6986E-03,-1.1799E-02,-2.4101E-02,&
        -2.2908E-02, 2.3052E-02,-8.2149E-03,&
        3.1831E-03,-7.8876E-04, 9.0815E-03,&
        2.5709E-03,-1.9943E-01, 1.6644E-02,&
        3.6662E-02, 8.7738E-03,-2.2514E-03,&
        -3.0569E-04, 3.6344E-04, 5.6322E-02,&
        1.1496E-02, 1.8602E-02,-1.9180E-03,&
        6.0620E-03,-6.3761E-04, 3.2952E-03,&
        -1.4087E-01, 8.0978E-03, 4.2363E-03,&
        5.9284E-03, 9.9418E-04, 1.9006E-03,&
        -9.8914E-02, 8.8500E-03, 2.2600E-03,&
        4.5221E-05,-1.4855E-04, 6.4891E-04,&
        3.2002E-02,-1.8770E-02, 2.5766E-04,&
        6.8798E-04, 7.8152E-04,-5.2227E-02,&
        1.3226E-03,-1.6813E-03, 4.7524E-05,&
        -3.5793E-04, 6.7469E-02,-1.0750E-02,&
        -2.0372E-03, 2.9722E-04, 4.0765E-02,&
        -1.4128E-02,-6.7906E-03, 6.6127E-04,&
        2.0483E-02, 2.7251E-03,-3.2169E-04,&
        7.7473E-02,-6.8423E-03,-1.5793E-03,&
        -2.6085E-02, 8.8083E-03, 4.2452E-02,&
        8.2699E-04, 2.1088E-02, 1.7894E-02/
    !     2000km equinox
    DATA (DERRTE(5,1,J),J=1,81)/ 2.4436E+00,-4.3843E-07, 1.5425E-01,&
        -5.5662E-08, 4.0385E-03, 8.1161E-07,&
        5.3553E-02,-6.9405E-07,-1.8544E-02,&
        1.7362E-01, 4.5975E-08,-6.9333E-03,&
        6.9511E-10,-1.9003E-02, 2.0966E-08,&
        -2.9413E-04,-4.3705E-08, 1.4120E-02,&
        -4.4319E-08, 2.6738E-02,-1.3382E-09,&
        -7.7713E-03,-2.1625E-08, 6.7646E-03,&
        2.9648E-08,-4.9498E-03,-6.9172E-09,&
        1.8036E-02, 8.0627E-09, 1.6950E-03,&
        -8.2902E-11, 2.3367E-04, 1.2521E-02,&
        -2.9426E-08,-1.0396E-02, 8.0042E-10,&
        3.0297E-03, 2.7689E-10,-9.5301E-04,&
        -2.3612E-02,-7.9111E-10,-7.6654E-03,&
        2.9311E-10,-2.8914E-04, 8.3715E-11,&
        -7.8202E-02, 6.6501E-09, 3.8289E-03,&
        4.0403E-09, 1.6187E-03,-5.7231E-10,&
        6.4240E-02,-3.3474E-09,-1.3766E-03,&
        -5.7988E-10, 6.2600E-04, 3.8725E-03,&
        1.5940E-08,-5.3759E-03,-2.1427E-09,&
        -8.9545E-04, 3.5896E-02,-4.3521E-09,&
        2.9789E-03, 1.0916E-09, 7.4931E-02,&
        -4.2211E-09,-8.2421E-03, 1.4316E-09,&
        -2.6314E-02,-4.4286E-10,-3.5706E-03,&
        6.3435E-02,-2.5381E-09,-2.2050E-03,&
        -6.6893E-02, 1.6210E-09, 4.0881E-02,&
        -5.1892E-09, 9.0158E-03, 2.3495E-02/
    !     2000km June solstice
    DATA (DERRTE(5,2,J),J=1,81)/ 2.4223E+00,-1.6581E-01, 2.0883E-01,&
        -8.0645E-02,-3.9722E-02, 1.5954E-02,&
        3.0088E-02,-9.6053E-03, 7.4229E-03,&
        1.4053E-01, 7.9878E-03, 4.2976E-02,&
        -2.6882E-02,-1.1069E-02,-5.6813E-03,&
        3.1338E-03,-7.3863E-03,-9.6881E-03,&
        -4.0146E-02, 1.3978E-02,-1.6224E-02,&
        9.3162E-03,-1.0888E-02,-1.4472E-02,&
        -5.4611E-03,-5.0694E-02, 5.5719E-02,&
        6.4098E-03, 2.0679E-03,-3.4277E-03,&
        2.9826E-03, 2.2637E-03, 4.8907E-02,&
        8.6854E-03, 6.6625E-03, 3.3814E-03,&
        7.7458E-04, 2.9699E-03,-6.9636E-04,&
        -9.5779E-03, 1.6612E-03, 1.3018E-02,&
        -5.0237E-03,-1.6025E-03, 1.3429E-03,&
        2.9054E-02, 7.2855E-03,-1.3993E-02,&
        -5.2888E-03,-2.7511E-05, 2.6011E-04,&
        1.5534E-02,-1.6128E-02, 6.3239E-03,&
        -3.7710E-03, 7.4519E-04,-5.6335E-02,&
        1.4123E-02, 7.2038E-03,-8.2835E-04,&
        -3.9963E-04, 2.0466E-02, 1.4346E-02,&
        -3.4267E-03, 5.6522E-04,-6.6495E-02,&
        -6.4634E-04, 4.2662E-04, 1.3420E-03,&
        2.0465E-02, 6.0863E-04, 4.9604E-04,&
        -2.2755E-02,-7.0387E-03, 1.3109E-03,&
        3.6849E-02, 2.2601E-03, 2.2893E-02,&
        -1.1385E-02, 4.4417E-02,-6.5754E-03/
    DO I=1,81
        DERRTE(1,3,I)=DERRTE(1,2,I)*MIRREQ(I)
        DERRTE(2,3,I)=DERRTE(2,2,I)*MIRREQ(I)
        DERRTE(3,3,I)=DERRTE(3,2,I)*MIRREQ(I)
        DERRTE(4,3,I)=DERRTE(4,2,I)*MIRREQ(I)
        DERRTE(5,3,I)=DERRTE(5,2,I)*MIRREQ(I)
    end do
    DO K=1,81
        DO J=1,3
            DO I=1,5
                DOUT(I,J,K)=DERRTE(I,J,K)
            end do
        end do
    end do
    !////////////////////////////////////////////////////////////////////////////////////
    RETURN
END
!
!
SUBROUTINE KOEFD(MIRREQ,DOUT)
    !------------------------------------------------------------------------------------
    !    coefficients - main model part
    !------------------------------------------------------------------------------------
    REAL DOUT(5,3,81)
    INTEGER MIRREQ(81),I,J,K
    REAL D(5,3,81)
    !     350km equinox
    DATA (D(1,1,J),J=1,81)/ 3.1753E+00, 5.7689E-07, 1.9586E-01,&
        -6.8275E-07, 1.8921E-02, 3.6213E-07,&
        -1.8628E-02, 5.0105E-08,-8.5600E-03,&
        -1.6010E-01,-9.6605E-08,-1.9714E-02,&
        2.1637E-07, 4.8494E-03,-3.8884E-07,&
        -3.4967E-03, 2.2421E-07, 2.1263E-02,&
        9.3647E-08,-7.9466E-03, 1.0780E-07,&
        9.0129E-03,-1.2648E-07, 9.2017E-05,&
        5.0372E-08,-7.7926E-02,-5.7641E-08,&
        -9.1840E-03,-2.8697E-08, 8.4038E-04,&
        -3.3483E-09, 9.8633E-04,-3.6580E-02,&
        2.6765E-07, 9.6558E-03, 3.1708E-09,&
        -3.7801E-04,-1.4056E-08,-7.5288E-04,&
        5.8945E-02,-6.4803E-08, 6.6372E-03,&
        -5.1910E-08, 6.6456E-05, 5.3576E-09,&
        -5.9863E-02,-2.4909E-07,-1.1843E-03,&
        4.9602E-08, 2.4969E-04,-7.2411E-09,&
        6.1304E-02,-9.0388E-08, 1.4235E-03,&
        9.6584E-09, 4.8905E-04, 3.4504E-02,&
        3.9764E-08, 2.2885E-04,-2.0067E-08,&
        -2.3446E-04,-5.3749E-02, 5.5106E-08,&
        -2.5829E-05,-3.6483E-10, 3.9294E-02,&
        -1.1888E-07,-1.1182E-04, 8.2427E-09,&
        -3.4563E-02,-4.2396E-08,-6.5573E-04,&
        -2.7676E-02,-1.3017E-08, 5.8774E-04,&
        1.6090E-02, 4.6780E-08,-2.0595E-02,&
        2.5706E-08, 1.2541E-02, 1.7794E-02/
    !     350km June solstice
    DATA (D(1,2,J),J=1,81)/ 3.1629E+00, 6.1302E-02, 2.0063E-01,&
        4.5285E-02,-4.1826E-02, 1.9260E-03,&
        2.4969E-03, 8.2077E-03,-2.8539E-02,&
        -1.6297E-01, 1.3558E-02,-2.4389E-02,&
        -3.1286E-03, 2.2763E-02, 2.1271E-03,&
        -6.5418E-03, 9.5738E-04, 1.6215E-02,&
        1.8507E-03,-1.0563E-03, 1.1742E-03,&
        -1.0133E-03,-1.9169E-03, 3.6940E-03,&
        -1.5715E-04,-5.6835E-02,-4.2398E-03,&
        6.2377E-03,-1.5667E-03, 4.1399E-04,&
        -2.1687E-03, 2.0367E-04,-1.4575E-02,&
        8.7408E-03,-1.5991E-03, 2.2254E-03,&
        1.3953E-03,-6.9929E-04,-1.0188E-03,&
        2.6039E-02,-7.4757E-04, 2.1545E-03,&
        1.0206E-03, 9.9516E-05,-5.1330E-04,&
        -4.3098E-03, 6.8083E-04, 1.7507E-03,&
        1.8198E-03,-5.2904E-04,-5.0768E-04,&
        3.1658E-02, 4.7564E-03,-9.2531E-04,&
        1.7889E-03,-3.7194E-05, 1.6896E-02,&
        -5.0829E-04,-8.1960E-04, 4.8322E-04,&
        -2.6520E-05,-1.0728E-02, 4.1619E-03,&
        3.8523E-04, 4.9239E-05, 1.1805E-02,&
        -2.9327E-03, 2.9543E-04, 2.9735E-04,&
        -9.7455E-03,-1.6474E-03, 1.0511E-03,&
        -1.7878E-02, 5.3427E-03, 1.7965E-05,&
        3.5806E-03, 6.6563E-04,-1.2012E-02,&
        -5.7183E-03, 2.4944E-03, 4.3333E-03/
    !     550km equinox
    DATA (D(2,1,J),J=1,81)/ 3.2751E+00, 1.3545E-06, 1.7150E-01,&
        -7.6203E-07, 4.0429E-02, 5.0117E-07,&
        -2.2589E-02, 3.0332E-08,-2.0861E-02,&
        -1.4168E-01, 2.7793E-07,-1.8331E-02,&
        2.2669E-07, 4.6414E-03, 6.9158E-08,&
        1.3312E-03,-1.0690E-07, 1.7280E-02,&
        3.6689E-07,-1.0921E-03,-4.8798E-07,&
        2.0699E-03, 1.5270E-07, 4.0919E-03,&
        -4.0587E-08,-8.4276E-02,-1.8326E-07,&
        -7.7966E-03, 2.9950E-07, 1.3969E-03,&
        2.2649E-08, 1.0082E-03,-3.1392E-02,&
        -5.0450E-08, 1.7356E-03,-1.4810E-08,&
        2.4669E-03, 2.0049E-08,-1.6503E-04,&
        5.6435E-02,-2.2274E-07, 4.4061E-03,&
        -1.8825E-08, 3.1341E-04, 1.3638E-08,&
        -4.7964E-02,-3.1192E-07,-3.8772E-04,&
        2.2998E-08,-5.8125E-05, 1.5519E-09,&
        4.9958E-02, 7.1110E-08, 1.6467E-03,&
        -3.5644E-08, 1.8249E-04, 2.7835E-02,&
        -1.2413E-07,-1.5793E-03, 2.2114E-08,&
        -3.9754E-04,-2.2227E-02, 2.2094E-07,&
        2.8621E-04, 5.3520E-09, 1.9280E-02,&
        5.1741E-08, 3.2861E-04,-1.7477E-08,&
        -1.9664E-02,-6.0668E-08,-3.8234E-05,&
        -1.8001E-02, 1.3656E-07, 4.1525E-04,&
        7.9458E-03,-1.0954E-07,-1.2869E-02,&
        -6.1937E-08, 9.2866E-03, 5.3834E-03/
    !     550km June solstice
    DATA (D(2,2,J),J=1,81)/ 3.2706E+00, 3.5202E-02, 1.6153E-01,&
        7.5517E-02,-1.2975E-02,-1.0202E-02,&
        -1.4402E-02, 8.0992E-03,-2.4350E-02,&
        -1.5168E-01, 2.1369E-02,-1.2387E-02,&
        -6.1981E-03, 9.1958E-03, 2.4677E-03,&
        -4.9595E-04,-9.1671E-04, 1.1726E-02,&
        1.3928E-04,-6.8449E-03, 3.9822E-03,&
        6.7074E-03,-2.3986E-03, 9.3211E-04,&
        -1.2521E-03,-7.7734E-02, 5.3710E-03,&
        3.3728E-04,-6.9879E-04, 1.9755E-03,&
        -2.3413E-04, 7.7060E-04,-2.7894E-02,&
        1.2731E-02, 1.9542E-03, 2.6609E-03,&
        -3.5695E-04,-1.1310E-03,-6.4754E-04,&
        4.2322E-02,-6.9529E-03,-7.8122E-04,&
        1.9300E-05,-6.5241E-04,-2.0369E-05,&
        -3.0919E-02, 1.4165E-03, 1.9683E-03,&
        3.6586E-05, 2.3327E-04, 7.7364E-05,&
        3.6784E-02, 2.2045E-03, 2.1286E-04,&
        6.5019E-04, 1.3530E-04, 1.2010E-02,&
        -1.1533E-03,-1.0365E-03, 5.2595E-04,&
        -1.9816E-04,-6.4129E-03,-2.9187E-04,&
        6.4120E-04,-4.3814E-04, 1.9807E-02,&
        -1.7670E-03,-5.2232E-04,-2.5243E-05,&
        -1.4894E-02, 7.9595E-04, 1.8406E-04,&
        9.1260E-04, 5.9450E-04, 3.9428E-04,&
        1.7175E-03,-7.0834E-04,-7.3342E-03,&
        9.3208E-04, 8.0461E-03, 1.7211E-03/
    !     850km equinox
    DATA (D(3,1,J),J=1,81)/ 3.4090E+00,-8.7890E-07, 1.4192E-01,&
        2.2022E-06,-2.3026E-02, 2.8080E-07,&
        -2.0490E-02,-2.4588E-06, 8.0287E-03,&
        -1.7872E-01,-5.9833E-07,-3.1967E-03,&
        5.7087E-07, 5.6724E-03,-3.6116E-08,&
        -3.9539E-03,-1.1406E-07, 2.5913E-02,&
        -4.3955E-07,-5.9265E-03, 3.8624E-07,&
        4.3640E-03,-2.1767E-07,-1.6975E-03,&
        1.4715E-08,-6.7945E-02, 6.7140E-07,&
        -5.8461E-03, 1.1914E-07, 2.4496E-04,&
        -4.9921E-08,-3.8830E-04,-1.2488E-02,&
        -3.9557E-07, 9.4377E-04, 1.5100E-07,&
        4.1863E-04,-2.6552E-08,-9.4832E-04,&
        3.7187E-02, 7.8305E-07,-3.6193E-03,&
        1.9130E-07,-5.5284E-04,-7.0234E-08,&
        -1.1616E-02, 7.5494E-08, 1.4075E-03,&
        7.9285E-08, 3.1501E-04,-3.4879E-08,&
        3.8138E-02, 4.5561E-07,-5.2993E-06,&
        7.2506E-08,-4.6427E-04, 1.1952E-02,&
        1.9508E-07,-7.3901E-04, 1.6083E-08,&
        4.6821E-04, 2.2138E-03, 1.9836E-08,&
        9.1512E-05, 2.5883E-10, 1.6160E-02,&
        9.8914E-08, 2.2891E-04, 3.5686E-08,&
        -2.3945E-02,-9.7206E-08, 4.1304E-04,&
        -1.1323E-02,-1.0595E-07, 2.4607E-06,&
        -1.1919E-02,-1.2954E-07,-1.5160E-02,&
        -9.8974E-08, 9.1103E-03,-9.8102E-04/
    !     850km June solstice
    DATA (D(3,2,J),J=1,81)/ 3.4298E+00, 2.6491E-02, 1.3842E-01,&
        4.0680E-02,-5.6606E-02,-5.7153E-03,&
        -1.4690E-02, 7.5677E-03, 3.2216E-04,&
        -1.8092E-01, 1.2032E-02, 8.3830E-03,&
        -1.6994E-03, 7.3073E-03, 4.6493E-03,&
        -5.9776E-03,-1.0911E-03, 1.8614E-02,&
        -6.0207E-03,-4.0287E-03,-2.4354E-03,&
        3.2668E-03, 2.0486E-03,-2.4568E-03,&
        1.7932E-04,-7.2842E-02, 1.2262E-03,&
        -2.4092E-03, 2.1826E-03, 1.1999E-03,&
        -5.7385E-04,-7.9356E-04,-4.8885E-03,&
        6.0397E-03, 1.5036E-03,-6.6850E-04,&
        -1.5557E-03, 7.0217E-04,-6.6930E-04,&
        2.7146E-02,-1.7554E-04,-5.7637E-03,&
        -4.8048E-05, 1.7230E-04, 2.7707E-04,&
        -1.8722E-02,-2.5534E-03, 2.7433E-03,&
        -9.4675E-04, 3.5885E-04, 1.6066E-04,&
        4.7142E-02,-3.8642E-03,-1.8094E-03,&
        3.7500E-04,-8.2361E-05, 3.4841E-04,&
        -2.1525E-03,-1.6265E-03,-5.6589E-04,&
        3.9127E-04, 2.3966E-02, 5.8480E-04,&
        1.1863E-05,-4.6920E-04,-3.2951E-03,&
        -1.3868E-03,-3.2869E-04,-4.1003E-05,&
        -8.5024E-03, 6.8306E-04, 1.2730E-03,&
        3.5803E-03,-6.7022E-05,-9.2460E-04,&
        -5.0650E-03, 2.3747E-03,-1.1690E-02,&
        2.7210E-04,-1.2308E-02,-2.4554E-03/
    !     1400km equinox
    DATA (D(4,1,J),J=1,81)/ 3.4323E+00, 5.9891E-08, 1.4440E-01,&
        -2.5296E-06,-3.0483E-02, 8.7633E-07,&
        -2.0333E-02, 1.4639E-06, 8.3905E-03,&
        -2.4661E-01,-3.3357E-07, 2.3371E-02,&
        -2.6009E-07, 7.4049E-03,-4.2111E-07,&
        -4.0153E-03, 3.2564E-07,-3.3975E-02,&
        -3.1496E-07, 5.0539E-04,-2.1844E-07,&
        6.6046E-03, 3.7777E-07, 1.0884E-03,&
        -1.7690E-07,-9.7080E-02,-1.0183E-06,&
        3.2316E-04, 2.3879E-07, 1.0714E-03,&
        -1.5921E-07,-2.2353E-04,-7.8730E-02,&
        -4.9271E-07,-3.3524E-03,-9.7695E-08,&
        4.0369E-06, 9.1746E-08, 4.3697E-04,&
        5.4799E-02,-1.5613E-06, 2.0376E-05,&
        1.5198E-07, 5.2388E-05,-4.3276E-08,&
        -1.9427E-02,-4.8251E-07,-3.6941E-03,&
        1.0404E-08,-3.8792E-04, 1.9478E-08,&
        2.7545E-02,-7.9193E-07, 1.9158E-05,&
        -3.8582E-08, 4.3319E-06, 2.1105E-02,&
        5.6969E-08,-1.4642E-03, 1.7346E-08,&
        -2.0981E-04,-1.6940E-02,-3.2828E-07,&
        9.3221E-04,-5.8952E-08, 2.2700E-02,&
        8.6772E-07,-3.0788E-04,-3.1938E-08,&
        -3.5342E-02,-4.1651E-08,-4.6744E-04,&
        3.2506E-03, 9.8322E-07, 2.4373E-04,&
        1.0563E-02,-4.2559E-08,-1.4966E-02,&
        6.3242E-07, 3.0936E-02, 5.0785E-04/
    !     1400km June solstice
    DATA (D(4,2,J),J=1,81)/ 3.4432E+00, 1.4031E-02, 1.3160E-01,&
        2.5090E-02,-4.2982E-02,-4.1350E-03,&
        -2.3576E-02, 4.5813E-04, 9.9480E-03,&
        -2.4132E-01, 3.9410E-03, 2.5328E-02,&
        2.5753E-03, 4.7467E-03, 2.4033E-03,&
        -4.5280E-03,-1.6768E-03,-2.4686E-02,&
        1.3680E-03, 4.5365E-03,-2.2588E-04,&
        4.7237E-03,-3.4808E-03, 1.9872E-03,&
        2.0111E-05,-1.0665E-01, 1.2940E-03,&
        5.1466E-04, 1.1414E-03,-2.6179E-04,&
        1.6622E-03,-2.9043E-04,-4.1638E-02,&
        2.5988E-03, 2.4967E-03, 1.1947E-03,&
        9.8563E-04,-1.1244E-03, 4.6249E-04,&
        2.2485E-02,-1.8404E-03,-2.7030E-03,&
        -5.6671E-04, 6.2775E-05, 2.3428E-04,&
        -1.9091E-02, 3.9310E-03,-1.3812E-03,&
        6.2219E-04, 4.0298E-04,-2.5167E-04,&
        3.6186E-02,-1.6894E-03,-9.2292E-04,&
        -3.5095E-04,-1.6027E-05, 5.0279E-03,&
        1.6496E-03,-1.2996E-03, 1.0942E-04,&
        -8.8813E-05,-9.8253E-04, 6.0205E-05,&
        3.1574E-04,-2.5650E-04, 1.6418E-02,&
        -7.4029E-04, 8.5019E-05, 7.1348E-05,&
        -8.8478E-03, 7.9330E-04, 4.9878E-04,&
        6.8566E-03,-1.3812E-03, 3.7630E-04,&
        -4.2406E-04,-4.0773E-05,-7.0264E-03,&
        -4.8997E-04, 3.2745E-03,-4.3985E-03/
    !     2000km equinox
    DATA (D(5,1,J),J=1,81)/ 3.5267E+00, 3.1496E-06, 1.0072E-01,&
        -4.0719E-06,-2.9570E-02, 3.1967E-06,&
        -1.6759E-02,-2.2291E-06, 1.4529E-02,&
        -2.0303E-01, 2.6118E-06, 2.3639E-02,&
        -1.5963E-06, 2.8544E-03, 6.3910E-07,&
        -6.4201E-03,-1.4241E-07,-2.2074E-02,&
        1.3024E-07,-6.5225E-04,-7.5969E-09,&
        6.8229E-03,-1.1600E-08, 6.5430E-04,&
        -3.1299E-09,-8.9155E-02, 1.0420E-06,&
        2.2701E-04,-2.8037E-07, 7.6229E-05,&
        9.0789E-08,-8.3574E-04,-4.3006E-02,&
        9.5987E-08,-2.5486E-03, 1.2764E-08,&
        1.6634E-03,-9.8076E-09,-2.0750E-05,&
        4.1638E-02, 1.2831E-07, 3.2205E-03,&
        -7.2843E-08, 4.7908E-04, 1.0592E-09,&
        -8.8335E-03,-8.6869E-08,-2.5895E-03,&
        8.5979E-09, 8.1594E-04, 4.8263E-09,&
        4.4205E-02,-4.5836E-08, 2.4211E-03,&
        -1.7175E-08, 1.3454E-04, 2.9288E-02,&
        -6.4336E-08,-4.7940E-04,-1.7677E-08,&
        2.7104E-04, 3.8585E-03,-1.9495E-08,&
        9.5007E-04, 1.4881E-10, 3.5952E-02,&
        1.2439E-07,-2.6259E-04,-3.3433E-08,&
        -4.5002E-03,-9.7622E-08, 1.0627E-04,&
        1.7064E-02, 2.6949E-07, 3.5386E-05,&
        1.3508E-03,-9.3600E-08, 2.2163E-03,&
        1.8302E-07, 1.4533E-02, 6.8208E-03/
    !     2000km June solstice
    DATA (D(5,2,J),J=1,81)/ 3.5455E+00, 2.3030E-02, 9.1028E-02,&
        5.6686E-03,-4.3555E-02, 7.5223E-03,&
        -5.3314E-03,-2.3664E-03, 9.2735E-03,&
        -1.7562E-01, 6.8722E-03, 2.6142E-02,&
        -7.5933E-03,-2.6850E-03, 1.5072E-03,&
        -3.8334E-03,-1.8455E-03,-8.3019E-03,&
        -3.1750E-03,-3.4582E-03,-3.0116E-03,&
        6.4951E-03,-1.9833E-04, 1.9620E-03,&
        -1.6688E-03,-9.1850E-02, 2.8064E-03,&
        1.1347E-03, 5.5757E-04,-1.7941E-03,&
        4.4038E-04,-7.6030E-04,-1.7519E-02,&
        5.5593E-03,-4.0485E-04, 1.0403E-04,&
        9.7795E-05,-4.4813E-04, 1.0662E-04,&
        -4.4894E-03,-4.3003E-03,-1.3180E-03,&
        1.2638E-03,-2.0937E-04,-1.0982E-04,&
        -2.8474E-02, 5.8161E-03,-5.9371E-04,&
        1.4721E-03,-1.8707E-04, 6.4902E-05,&
        6.2783E-03,-1.3854E-03, 2.9896E-04,&
        -7.7301E-04,-1.6992E-05,-2.8036E-02,&
        1.9110E-03,-1.7128E-04, 6.0156E-04,&
        -1.7487E-04, 2.9229E-03,-1.4161E-03,&
        5.1841E-04,-8.2856E-05,-1.0698E-02,&
        -4.2081E-03,-4.5016E-04, 5.1778E-07,&
        1.4779E-02, 5.7698E-04,-3.6797E-04,&
        -4.7711E-03,-1.6291E-03,-4.5695E-04,&
        1.1890E-02,-1.6669E-04,-5.5450E-03,&
        -1.0370E-03,-4.2745E-03, 1.8717E-03/
    DO I=1,81
        D(1,3,I)=D(1,2,I)*MIRREQ(I)
        D(2,3,I)=D(2,2,I)*MIRREQ(I)
        D(3,3,I)=D(3,2,I)*MIRREQ(I)
        D(4,3,I)=D(4,2,I)*MIRREQ(I)
        D(5,3,I)=D(5,2,I)*MIRREQ(I)
    end do
    DO K=1,81
        DO J=1,3
            DO I=1,5
                DOUT(I,J,K)=D(I,J,K)
            end do
        end do
    end do
    !////////////////////////////////////////////////////////////////////////////////////
    RETURN
END
!
!
SUBROUTINE KOF107(MIRREQ,DOUT)
    !------------------------------------------------------------------------------------
    !   coefficients - F107 model part
    !------------------------------------------------------------------------------------
    REAL DOUT(5,3,81)
    INTEGER MIRREQ(81),I,J,K
    REAL DPF107(5,3,81)
    !     350km equinox
    DATA (DPF107(1,1,J),J=1,81)/ 2.1179E+00, 2.6093E-07, 4.4282E-02,&
        -1.3876E-06, 2.7803E-02, 1.3986E-06,&
        2.9846E-02, 5.5440E-07, 1.3094E-02,&
        -2.5151E-02,-1.0646E-07,-3.7429E-03,&
        1.6883E-08,-8.7810E-05, 2.4570E-08,&
        5.3157E-04, 2.4498E-09,-7.4921E-03,&
        3.4559E-07, 2.7384E-03,-2.9301E-07,&
        -6.4160E-03,-2.9594E-08,-1.2326E-03,&
        2.0038E-07, 1.4916E-01, 8.9752E-08,&
        1.7673E-02,-3.3613E-08, 3.8401E-03,&
        5.1558E-08, 4.3661E-05,-1.3354E-01,&
        -4.2996E-08,-1.6325E-02,-5.9756E-08,&
        -7.8924E-04, 9.0574E-09, 9.4891E-05,&
        -4.6522E-02, 1.6467E-07, 3.0933E-03,&
        -2.4212E-08,-8.5264E-04,-2.8060E-09,&
        2.0465E-02, 3.9607E-08, 2.4059E-03,&
        2.3086E-08,-9.3343E-04, 2.1124E-08,&
        3.5658E-02,-4.9285E-08,-9.9046E-04,&
        -2.8411E-08, 4.9889E-04,-2.0836E-02,&
        2.7124E-07, 3.9610E-03,-5.1577E-08,&
        1.2194E-03, 2.0681E-02, 2.2079E-08,&
        -1.5148E-03,-1.4727E-08, 2.9282E-02,&
        -7.1036E-08,-1.0708E-03,-7.0356E-09,&
        3.5476E-02, 1.4627E-08, 1.6406E-03,&
        2.0173E-02, 1.1973E-07, 5.7493E-06,&
        9.8510E-04,-5.6858E-08,-6.9055E-03,&
        8.8015E-08,-5.2797E-03, 4.9785E-02/
    !     350km June solstice
    DATA (DPF107(1,2,J),J=1,81)/ 2.1118E+00, 1.2667E-02, 7.8532E-02,&
        2.8013E-03, 4.6247E-03,-1.8002E-02,&
        1.7402E-02, 2.1645E-02, 9.7880E-04,&
        1.6106E-03, 1.5252E-02, 4.2830E-04,&
        2.2738E-03, 5.1962E-03,-1.2009E-03,&
        -2.4580E-03, 1.1339E-03, 2.4005E-03,&
        -9.1238E-03,-6.2242E-03, 7.1732E-04,&
        4.7369E-03,-2.0235E-03,-2.8728E-03,&
        1.5519E-03,-1.5735E-01, 5.1640E-03,&
        -1.0377E-02, 1.5376E-03,-1.2147E-04,&
        1.1153E-03,-4.0444E-04, 6.2152E-02,&
        4.3814E-03, 8.5715E-03,-1.1794E-03,&
        -1.4507E-03,-2.9136E-04, 4.8678E-05,&
        -2.5783E-02,-6.4352E-03, 2.8888E-03,&
        -2.3923E-04,-7.8468E-04, 1.0567E-04,&
        1.8717E-02,-3.7789E-03, 1.9293E-03,&
        2.7927E-03, 6.1046E-04,-6.4161E-04,&
        2.9512E-02, 1.8061E-03,-6.0273E-04,&
        -1.4189E-03,-1.2866E-04, 3.4173E-02,&
        7.0098E-03, 2.7884E-03, 1.3619E-03,&
        1.0141E-03, 4.4472E-02,-3.6668E-03,&
        -6.6634E-04,-9.1539E-04,-4.3310E-02,&
        4.6828E-03,-1.0213E-03, 9.6850E-04,&
        -8.9240E-04, 3.0694E-03, 1.1888E-03,&
        -3.2205E-02, 2.4068E-04, 1.5491E-03,&
        -1.3486E-03, 1.5805E-03, 1.2679E-02,&
        1.5963E-03,-9.2296E-03, 3.3470E-02/
    !     550km equinox
    DATA (DPF107(2,1,J),J=1,81)/ 2.2596E+00,-1.0250E-06,-6.0469E-02,&
        -5.1717E-08, 2.4081E-02, 1.3561E-06,&
        2.2501E-02, 1.8975E-07,-1.9328E-03,&
        1.8631E-03,-6.9838E-08, 8.5643E-03,&
        2.2625E-07,-9.6354E-04, 1.4344E-07,&
        -9.9794E-04,-1.4888E-07,-2.1439E-02,&
        1.6757E-07, 2.2087E-02, 1.9753E-07,&
        3.3401E-03, 1.7510E-08,-4.4513E-03,&
        -1.9434E-07, 2.1312E-02, 4.1158E-07,&
        4.1293E-03, 1.2532E-07, 1.6378E-03,&
        -6.0591E-08, 3.8969E-04,-8.2128E-04,&
        -3.7332E-07,-9.0674E-03,-1.6562E-07,&
        -6.4580E-04,-2.4214E-08, 1.7187E-04,&
        -7.8323E-03,-3.4188E-09,-3.3704E-03,&
        -3.7064E-08,-8.1990E-04,-3.4103E-08,&
        2.8832E-04,-1.3091E-07, 5.9580E-04,&
        3.5007E-09,-2.4893E-05, 3.7407E-08,&
        9.8550E-03, 5.2340E-08, 2.4715E-03,&
        -2.2799E-09, 6.0276E-04,-2.3370E-03,&
        1.5897E-07,-7.8384E-04, 6.2186E-08,&
        1.5512E-04, 1.0034E-03, 6.2956E-08,&
        1.2935E-03, 1.1142E-08,-5.6848E-03,&
        5.7028E-08,-1.1159E-03, 5.2481E-09,&
        -6.4583E-04,-4.9024E-08,-8.7256E-05,&
        -3.6805E-03,-4.2162E-11, 5.9164E-04,&
        -1.1688E-03,-6.3884E-09,-3.4464E-03,&
        -2.9236E-08,-3.2531E-03, 7.3254E-04/
    !     550km June solstice
    DATA (DPF107(2,2,J),J=1,81)/ 2.2443E+00,-7.5467E-03, 4.6154E-03,&
        -3.2706E-02,-9.4369E-03,-2.9842E-03,&
        9.5202E-03, 2.6462E-02, 8.1390E-03,&
        2.2865E-03,-8.1542E-03, 1.1328E-03,&
        -4.8105E-03, 1.5307E-03, 1.8632E-03,&
        1.1856E-03, 9.7583E-04,-1.4236E-03,&
        1.0665E-02, 1.1196E-02, 1.0141E-02,&
        2.7029E-03, 7.6283E-04,-2.2904E-04,&
        -7.3431E-04,-6.9053E-03, 2.8684E-04,&
        8.7857E-04, 8.9792E-04, 1.8426E-03,&
        1.0182E-05, 9.9144E-04,-6.8376E-03,&
        4.1889E-03,-8.3520E-04, 4.7692E-03,&
        -2.1779E-04,-3.2160E-04,-2.3404E-04,&
        -3.9832E-03,-8.0937E-04,-2.5324E-03,&
        -1.1029E-04,-3.9410E-04,-2.9127E-04,&
        1.4673E-02, 1.4644E-03, 4.4913E-03,&
        1.2082E-03, 1.1461E-03, 9.7184E-04,&
        8.7871E-03, 2.9808E-05, 2.7913E-03,&
        7.6192E-04, 9.4134E-04, 5.0748E-04,&
        3.2757E-03, 1.3459E-03, 7.4301E-04,&
        5.2271E-05,-1.1622E-03, 2.0424E-03,&
        7.4028E-04, 3.1044E-04,-7.8888E-04,&
        7.3294E-04, 4.5496E-04, 3.7781E-04,&
        -6.7759E-03,-1.3669E-03, 2.5073E-04,&
        7.8526E-03, 2.1084E-04,-6.8010E-06,&
        -1.2768E-04, 9.3358E-05, 5.0014E-03,&
        5.5091E-04, 6.4201E-04, 2.6821E-03/
    !     850km equinox
    DATA (DPF107(3,1,J),J=1,81)/ 2.2430E+00, 6.3529E-07,-2.1093E-02,&
        2.3192E-06, 3.9848E-03,-4.0399E-06,&
        -2.0864E-03, 1.4147E-06,-2.7632E-03,&
        3.8821E-03, 4.3770E-07,-6.7410E-04,&
        3.7620E-07, 2.5406E-04,-5.5479E-07,&
        4.2678E-04, 3.7791E-07,-2.1396E-03,&
        4.3688E-07,-1.3975E-04, 5.5689E-08,&
        -7.7591E-04,-2.3032E-07,-7.6251E-06,&
        1.1410E-07, 3.5107E-02, 3.3463E-07,&
        5.8991E-03,-1.6889E-07, 6.4584E-04,&
        1.6902E-07, 1.7415E-04, 7.1402E-03,&
        4.6111E-07,-6.6733E-04, 1.5319E-07,&
        -2.8179E-04,-4.4107E-08, 1.8358E-04,&
        3.9796E-03,-4.7690E-08,-2.6286E-04,&
        -1.6931E-07, 5.3136E-05, 4.6929E-08,&
        4.6506E-06, 1.0615E-07,-2.2795E-04,&
        -1.9598E-08,-3.4348E-05,-1.8839E-08,&
        -6.1345E-03,-1.5260E-08, 5.7992E-04,&
        -7.6335E-08, 2.2449E-04, 4.1926E-03,&
        4.8940E-08, 1.2125E-03,-7.3629E-08,&
        3.8057E-04, 1.9487E-03,-1.6906E-09,&
        2.1031E-04,-8.3425E-09,-2.3397E-03,&
        3.7214E-08,-2.0578E-04,-7.7983E-08,&
        1.9869E-02,-1.5178E-07, 7.1451E-05,&
        -1.6288E-02,-2.8123E-08,-6.2559E-04,&
        1.6419E-04,-8.6871E-08,-3.8220E-03,&
        -3.4288E-08,-1.6062E-02,-2.3689E-03/
    !     850km June solstice
    DATA (DPF107(3,2,J),J=1,81)/ 2.2234E+00, 8.7471E-03,-3.6271E-02,&
        -1.8205E-02, 1.4310E-02, 1.4137E-02,&
        1.1152E-03,-5.6408E-03,-2.3086E-04,&
        9.8994E-03, 3.6786E-04,-7.5900E-03,&
        3.6605E-03, 4.2347E-03, 9.9788E-04,&
        -1.0637E-03, 6.0786E-05, 3.3041E-03,&
        3.2600E-03,-3.9354E-03,-1.1438E-04,&
        2.8440E-03, 6.3044E-04,-1.1396E-03,&
        1.1203E-04, 3.9674E-02, 1.7704E-03,&
        -1.3756E-03,-2.0221E-04,-5.5309E-04,&
        2.5297E-04, 2.3301E-04, 2.1051E-02,&
        8.2900E-03,-9.2282E-04,-2.2149E-03,&
        -1.2940E-03, 5.0482E-04, 3.2355E-04,&
        3.3826E-03,-6.9424E-03, 4.4450E-04,&
        3.5048E-04,-2.8501E-04, 8.5714E-05,&
        5.0172E-05,-6.0011E-03,-1.9778E-03,&
        7.9132E-04, 4.8467E-04,-8.8136E-06,&
        5.5216E-03,-3.1276E-03,-1.6523E-03,&
        2.7189E-04, 1.2939E-04, 1.6626E-02,&
        -3.9681E-04, 3.1331E-03, 1.1602E-05,&
        -2.8408E-04, 1.3352E-02, 2.8371E-03,&
        4.9534E-04,-1.7470E-04,-6.1464E-04,&
        -7.3693E-03,-2.1311E-04, 8.8980E-05,&
        2.0388E-02, 2.5072E-04,-1.3785E-03,&
        -2.1501E-02,-2.0520E-03, 3.9847E-04,&
        -9.8123E-04, 3.0419E-03, 6.5642E-03,&
        -1.3463E-03,-4.1453E-03,-3.4043E-03/
    !     1400km equinox
    DATA (DPF107(4,1,J),J=1,81)/ 2.0721E+00,-1.2810E-06,-2.2446E-02,&
        4.0113E-06, 1.5405E-02,-4.0985E-06,&
        -4.4873E-03, 1.6972E-06, 1.0420E-03,&
        -1.0762E-03, 4.3349E-08, 1.2188E-03,&
        2.3954E-08,-2.0416E-03,-2.3801E-08,&
        2.9302E-04,-2.3188E-08,-7.1780E-04,&
        -1.8559E-08,-2.6530E-03,-9.1704E-08,&
        1.9664E-03, 7.4905E-08, 9.7068E-06,&
        3.6472E-08, 9.6520E-03,-1.1466E-06,&
        -5.4198E-03, 4.4641E-07,-1.3638E-04,&
        -8.7144E-08, 4.4808E-05,-3.3499E-02,&
        1.2687E-06, 2.7432E-03,-6.2446E-07,&
        -4.9937E-04, 1.3601E-07,-1.1713E-04,&
        7.6744E-03,-2.2096E-08,-5.5947E-05,&
        -3.6655E-08,-2.3160E-04, 1.5485E-09,&
        1.9511E-03, 3.2565E-08,-5.0748E-04,&
        -2.2702E-08, 2.1519E-04, 4.2344E-09,&
        -2.4070E-02, 4.2536E-08,-1.0566E-03,&
        -4.8657E-08,-2.4020E-05,-5.3805E-02,&
        1.2672E-06, 1.9215E-03,-1.5258E-07,&
        1.4154E-04,-3.3868E-03, 4.4217E-08,&
        -6.1293E-04,-1.1966E-08,-7.1448E-03,&
        -1.3842E-08,-4.8955E-04, 1.9888E-08,&
        -5.3833E-02, 5.0588E-07, 1.7924E-04,&
        -1.0013E-02, 4.5334E-07, 4.6489E-04,&
        -1.7219E-05, 2.8226E-08, 1.2155E-03,&
        -5.5547E-08,-2.5776E-02, 3.7582E-02/
    !     1400km June solstice
    DATA (DPF107(4,2,J),J=1,81)/ 2.0715E+00, 1.1060E-02,-7.2558E-03,&
        1.6759E-02, 4.4526E-03,-3.1949E-03,&
        -1.1849E-03, 1.9253E-03, 1.6289E-03,&
        2.1829E-04,-3.3721E-03, 2.6217E-03,&
        7.8261E-04, 5.2241E-04,-1.0364E-03,&
        1.4120E-05,-1.7664E-04, 2.6144E-03,&
        4.9622E-04,-1.1139E-03, 2.5938E-03,&
        -1.3858E-03,-4.7107E-04,-2.2748E-04,&
        -6.5263E-04, 1.5465E-04,-1.8961E-04,&
        1.9626E-03,-1.3251E-03,-3.5464E-04,&
        -3.6056E-04, 7.2928E-04,-3.4355E-02,&
        -5.4377E-04,-3.7358E-04,-5.4676E-04,&
        -6.0062E-04,-8.5823E-05,-4.2649E-04,&
        -2.5657E-03, 2.0810E-03,-5.0775E-04,&
        -6.9662E-05,-1.1269E-04,-2.9248E-05,&
        -4.2538E-04, 3.1001E-03, 9.3147E-05,&
        -2.0474E-04, 9.2787E-05, 1.5224E-04,&
        1.6699E-02,-1.0915E-03, 3.9374E-04,&
        6.2488E-05, 5.3697E-05, 4.2104E-03,&
        2.6857E-04,-5.6046E-04,-1.7589E-04,&
        -1.6645E-04,-1.0895E-03, 3.1274E-04,&
        -7.0907E-05,-1.8092E-04,-3.0431E-03,&
        -4.6234E-04,-2.6949E-05,-3.1150E-06,&
        4.6148E-03,-3.4373E-04, 9.9880E-04,&
        -2.2815E-03, 3.8619E-04,-8.9996E-05,&
        -2.2212E-05, 2.8260E-04, 3.3863E-03,&
        -6.4781E-04, 1.0682E-02,-5.7521E-03/
    !     2000km equinox
    DATA (DPF107(5,1,J),J=1,81)/ 2.2225E+00,-1.8465E-07, 3.9702E-02,&
        7.4498E-08, 6.7294E-03,-1.5623E-07,&
        8.6264E-04, 4.9782E-07,-1.0457E-02,&
        -1.7603E-02,-4.2609E-07, 1.1957E-02,&
        2.8967E-07, 4.0676E-03,-4.8392E-08,&
        -2.0672E-03,-2.7825E-08, 2.3117E-02,&
        -8.1847E-07, 6.3865E-04, 1.2350E-07,&
        -3.1363E-03, 2.3973E-08, 7.4011E-04,&
        2.2201E-08, 1.5339E-02,-9.2354E-07,&
        -5.0780E-04, 2.4487E-07,-1.4002E-03,&
        -9.5180E-08,-2.2099E-04,-2.6709E-02,&
        2.0174E-07, 5.2254E-03,-6.4659E-08,&
        -4.5011E-04,-1.3226E-08,-5.0770E-04,&
        2.3246E-02, 4.0279E-07, 4.2692E-03,&
        -8.2578E-08, 2.8635E-04, 1.9589E-08,&
        6.1547E-04,-1.6112E-07,-3.4024E-03,&
        -3.3185E-08,-8.0475E-04, 6.1774E-09,&
        3.9677E-02, 1.8432E-07, 2.2421E-03,&
        -3.3228E-09,-2.2705E-05,-2.1308E-02,&
        -1.1246E-07, 2.6961E-03, 2.2048E-08,&
        1.6385E-05, 1.0901E-02, 4.6221E-07,&
        -3.8862E-06,-4.9407E-08, 1.3349E-02,&
        9.8339E-08,-5.5719E-04,-1.8928E-08,&
        3.9061E-02, 4.3038E-07, 1.0085E-03,&
        1.1895E-02, 4.6967E-07, 4.3363E-04,&
        -5.3628E-03, 4.2370E-07, 1.2707E-03,&
        1.0193E-07, 1.2395E-02, 1.0030E-02/
    !     2000km June solstice
    DATA (DPF107(5,2,J),J=1,81)/ 2.2631E+00, 2.1866E-02, 4.6921E-03,&
        -3.3329E-02, 1.0108E-02,-1.2195E-02,&
        4.8366E-03, 2.1350E-02,-8.6916E-03,&
        3.4443E-03,-7.1057E-03,-1.4225E-03,&
        -9.9691E-03,-6.0693E-04,-2.9332E-03,&
        -1.0505E-03,-1.9665E-03, 2.1469E-02,&
        -1.9500E-02,-1.0986E-02, 5.2916E-03,&
        2.7388E-03,-4.6114E-05,-2.6742E-03,&
        2.0601E-06, 7.5298E-03,-1.1021E-02,&
        -3.8100E-03,-1.2864E-03,-1.0705E-03,&
        -4.8383E-04,-1.2329E-03, 3.4064E-02,&
        -1.6264E-02, 2.6406E-04, 1.1486E-03,&
        2.0181E-03, 4.7744E-04,-2.2118E-04,&
        8.5559E-03, 4.6544E-03,-3.0707E-03,&
        1.0697E-03, 7.4102E-05,-6.8598E-04,&
        -3.7443E-02,-4.1490E-03, 4.8394E-03,&
        2.8449E-04,-8.1610E-04, 4.1996E-04,&
        -2.3120E-02,-2.2430E-03,-1.6598E-03,&
        5.4323E-04,-3.9800E-04, 8.7947E-03,&
        5.9441E-03, 1.2565E-04, 8.0901E-04,&
        -7.3510E-04,-2.1540E-02,-2.6029E-04,&
        1.1616E-03,-1.5312E-04, 6.3625E-03,&
        -4.0037E-03,-1.5571E-03,-5.7964E-04,&
        8.1764E-03,-2.3762E-05,-1.2959E-04,&
        6.2361E-03,-4.9235E-03, 6.0991E-04,&
        1.6101E-03,-3.9088E-03,-1.3380E-02,&
        -4.2837E-04,-1.1667E-02, 3.9335E-03/
    DO I=1,81
        DPF107(1,3,I)=DPF107(1,2,I)*MIRREQ(I)
        DPF107(2,3,I)=DPF107(2,2,I)*MIRREQ(I)
        DPF107(3,3,I)=DPF107(3,2,I)*MIRREQ(I)
        DPF107(4,3,I)=DPF107(4,2,I)*MIRREQ(I)
        DPF107(5,3,I)=DPF107(5,2,I)*MIRREQ(I)
    end do
    DO K=1,81
        DO J=1,3
            DO I=1,5
                DOUT(I,J,K)=DPF107(I,J,K)
            end do
        end do
    end do
    !////////////////////////////////////////////////////////////////////////////////////
    RETURN
END
!
!
SUBROUTINE locate(xx,n,x,j)
    !------------------------------------------------------------------------------------
    INTEGER j,n
    REAL x,xx(n)
    INTEGER jl,jm,ju
    jl=0
    ju=n+1
    10    if(ju-jl > 1)then
        jm=(ju+jl)/2
        if((xx(n) > xx(1)).eqv.(x > xx(jm)))then
            jl=jm
        else
            ju=jm
        endif
        goto 10
    endif
    j=jl
    return
END
!
!
SUBROUTINE SPHARM_IK(C,L,M,COLAT,AZ)
    !------------------------------------------------------------------------------------
    ! CALCULATES THE COEFFICIENTS OF THE SPHERICAL HARMONIC
    ! FROM IRI 95 MODEL
    ! NOTE: COEFFICIENTS CORRESPONDING TO COS, SIN SWAPPED!!!
    !------------------------------------------------------------------------------------
    DIMENSION C(82)
    C(1)=1.
    K=2
    X=COS(COLAT)
    C(K)=X
    K=K+1
    DO I=2,L
        C(K)=((2*I-1)*X*C(K-1)-(I-1)*C(K-2))/I
        K=K+1
    end do
    Y=SIN(COLAT)
    DO MT=1,M
        CAZ=COS(MT*AZ)
        SAZ=SIN(MT*AZ)
        C(K)=Y**MT
        K=K+1
        IF(MT == L) GOTO 16
        C(K)=C(K-1)*X*(2*MT+1)
        K=K+1
        IF((MT+1) == L) GOTO 16
        DO I=2+MT,L
            C(K)=((2*I-1)*X*C(K-1)-(I+MT-1)*C(K-2))/(I-MT)
            K=K+1
        end do
        16    N=L-MT+1
        DO I=1,N
            C(K)=C(K-N)*SAZ
            C(K-N)=C(K-N)*CAZ
            K=K+1
        end do
    end do
    RETURN
END
!
!
SUBROUTINE spline(x,y,n,yp1,ypn,y2)
    !------------------------------------------------------------------------------------
    INTEGER n,NMAX
    REAL yp1,ypn,x(n),y(n),y2(n)
    PARAMETER (NMAX=500)
    INTEGER i,k
    REAL p,qn,sig,un,u(NMAX)
    if (yp1 > .99e30) then
        y2(1)=0.
        u(1)=0.
    else
        y2(1)=-0.5
        u(1)=(3./(x(2)-x(1)))*((y(2)-y(1))/(x(2)-x(1))-yp1)
    endif
    do i=2,n-1
        sig=(x(i)-x(i-1))/(x(i+1)-x(i-1))
        p=sig*y2(i-1)+2.
        y2(i)=(sig-1.)/p
        u(i)=(6.*((y(i+1)-y(i))/(x(i+&
            1)-x(i))-(y(i)-y(i-1))/(x(i)-x(i-1)))/(x(i+1)-x(i-1))-sig*&
            u(i-1))/p
    end do
    if (ypn > .99e30) then
        qn=0.
        un=0.
    else
        qn=0.5
        un=(3./(x(n)-x(n-1)))*(ypn-(y(n)-y(n-1))/(x(n)-x(n-1)))
    endif
    y2(n)=(un-qn*u(n-1))/(qn*y2(n-1)+1.)
    do k=n-1,1,-1
        y2(k)=y2(k)*y2(k+1)+u(k)
    end do
    return
END
!
!
SUBROUTINE splint(xa,ya,y2a,n,x,y)
    !------------------------------------------------------------------------------------
    INTEGER n
    REAL x,y,xa(n),y2a(n),ya(n)
    INTEGER k,khi,klo
    REAL a,b,h
    klo=1
    khi=n
    1     if (khi-klo > 1) then
        k=(khi+klo)/2
        if(xa(k) > x)then
            khi=k
        else
            klo=k
        endif
        goto 1
    endif
    h=xa(khi)-xa(klo)
    a=(xa(khi)-x)/h
    b=(x-xa(klo))/h
    y=a*ya(klo)+b*ya(khi)+((a**3-a)*y2a(klo)+(b**3-b)*y2a(khi))*(h**&
        2)/6.
    return
END
!
!
SUBROUTINE SWAPEL(N,A)
    !------------------------------------------------------------------------------------
    !      swaps elements of array
    !------------------------------------------------------------------------------------
    INTEGER N,I
    REAL A(N),AT(N)
    DO I=1,N
        AT(I)=A(I)
    end do
    DO I=0,N-1
        A(I+1)=AT(N-I)
    end do
    RETURN
END
!
!
SUBROUTINE TEDIFI(F107IN,TEXN,TEDN,F107DF,TEDIF)
    !------------------------------------------------------------------------------------
    !      interpolation for solar activity
    !------------------------------------------------------------------------------------
    REAL F107IN,TEXN,TEDN,F107DF(3),TEDIF
    REAL T0DNXN(3),T0DN(2),TDNXN(2)
    REAL INTERP
    IF ((F107IN  >=  F107DF(1)) .AND. (F107IN  <=  F107DF(3))) THEN
        T0DNXN(1)=0.
        T0DNXN(2)=TEDN
        T0DNXN(3)=TEXN
        TEDIF=INTERP(3,2,T0DNXN,F107DF,F107IN)
    END IF
    IF (F107IN  <  F107DF(1)) THEN
        T0DN(1)=0.
        T0DN(2)=TEDN
        TEDIF=INTERP(2,1,T0DN,F107DF(1),F107IN)
    END IF
    IF (F107IN  >  F107DF(3)) THEN
        TDNXN(1)=TEDN
        TDNXN(2)=TEXN
        TEDIF=INTERP(2,1,TDNXN,F107DF(2),F107IN)
    END IF
    RETURN
END
!
!
SUBROUTINE TPCAS(MLTRAD,PF107,PF107M,&
        XNDI,DNDI,PD,XNNI,DNNI,PN,TPASEA)
    !------------------------------------------------------------------------------------
    !      correction for season at fixed altitude
    !------------------------------------------------------------------------------------
    REAL MLTRAD,PF107,PF107M,XNDI,DNDI,PD(3),XNNI,DNNI,PN(3),TPASEA
    REAL TA,TM,TDC,TNC
    CALL TEDIFI(PF107,XNDI,DNDI,PD,TA)
    CALL TEDIFI(PF107M,XNDI,DNDI,PD,TM)
    TDC=TA-TM
    TDC=AMAX1(TDC,-1250.)
    TDC=AMIN1(TDC,1250.)
    CALL TEDIFI(PF107,XNNI,DNNI,PN,TA)
    CALL TEDIFI(PF107M,XNNI,DNNI,PN,TM)
    TNC=TA-TM
    TNC=AMAX1(TNC,-1250.)
    TNC=AMIN1(TNC,1250.)
    !      harmonic interpolation for local time
    TPASEA=(1.-COS(MLTRAD))/2.*(TDC-TNC)+TNC
    RETURN
END
!
!
SUBROUTINE   TPCORR(INVDIP,MLT,DDD,PF107,&
        P350A,P350B,P550A,P550B,P850A,P850B,&
        P1400A,P1400B,P2000A,P2000B, &
        TP350A,TP350B,TP550A,TP550B,TP850A,TP850B,&
        TP140A,TP140B,TP200A,TP200B)
    !------------------------------------------------------------------------------------
    REAL INVDIP,MLT,PF107
    INTEGER DDD
    REAL        P350A,P350B,P550A,P550B,P850A,P850B,&
        P1400A,P1400B,P2000A,P2000B, &
        TP350A,TP350B,TP550A,TP550B,TP850A,TP850B,&
        TP140A,TP140B,TP200A,TP200B
    REAL INTERP
    REAL MLTRAD
    !      Constants
    REAL INVDPQ(13)
    !      PF107 Day Equinox
    REAL P2DE(13,3),P1DE(13,3),P8DE(13,3),P5DE(13,3),P3DE(13,3)
    !      Te max-min dif Day Equinox
    REAL CXN2DE(13),CXN1DE(13),CXN8DE(13),CXN5DE(13),CXN3DE(13)
    !      Te med-min dif Day Equinox
    REAL CDN2DE(13),CDN1DE(13),CDN8DE(13),CDN5DE(13),CDN3DE(13)
    !
    !      PF107 Night Equinox
    REAL P2NE(13,3),P1NE(13,3),P8NE(13,3),P5NE(13,3),P3NE(13,3)
    !      Te max-min dif Night Equinox
    REAL CXN2NE(13),CXN1NE(13),CXN8NE(13),CXN5NE(13),CXN3NE(13)
    !      Te med-min dif Night Equinox
    REAL CDN2NE(13),CDN1NE(13),CDN8NE(13),CDN5NE(13),CDN3NE(13)
    !
    !
    !      PF107 Day Solstice
    REAL P2DS(13,3),P1DS(13,3),P8DS(13,3),P5DS(13,3),P3DS(13,3)
    !      Te max-min dif Day Solstice
    REAL CXN2DS(13),CXN1DS(13),CXN8DS(13),CXN5DS(13),CXN3DS(13)
    !      Te med-min dif Day Solstice
    REAL CDN2DS(13),CDN1DS(13),CDN8DS(13),CDN5DS(13),CDN3DS(13)
    !
    !      PF107 Night Solstice
    REAL P2NS(13,3),P1NS(13,3),P8NS(13,3),P5NS(13,3),P3NS(13,3)
    !      Te max-min dif Night Solstice
    REAL CXN2NS(13),CXN1NS(13),CXN8NS(13),CXN5NS(13),CXN3NS(13)
    !      Te med-min dif Night Solstice
    REAL CDN2NS(13),CDN1NS(13),CDN8NS(13),CDN5NS(13),CDN3NS(13)
    !      working variables
    REAL TXN2DE(13),TXN1DE(13),TXN8DE(13),TXN5DE(13),TXN3DE(13)
    REAL TDN2DE(13),TDN1DE(13),TDN8DE(13),TDN5DE(13),TDN3DE(13)
    REAL TXN2NE(13),TXN1NE(13),TXN8NE(13),TXN5NE(13),TXN3NE(13)
    REAL TDN2NE(13),TDN1NE(13),TDN8NE(13),TDN5NE(13),TDN3NE(13)
    REAL TXN2DS(13),TXN1DS(13),TXN8DS(13),TXN5DS(13),TXN3DS(13)
    REAL TDN2DS(13),TDN1DS(13),TDN8DS(13),TDN5DS(13),TDN3DS(13)
    REAL TXN2NS(13),TXN1NS(13),TXN8NS(13),TXN5NS(13),TXN3NS(13)
    REAL TDN2NS(13),TDN1NS(13),TDN8NS(13),TDN5NS(13),TDN3NS(13)
    !
    !      Interpolated PF107
    REAL P2DEI(3),P1DEI(3),P8DEI(3),P5DEI(3),P3DEI(3)
    REAL P2NEI(3),P1NEI(3),P8NEI(3),P5NEI(3),P3NEI(3)
    REAL P2DSI(3),P1DSI(3),P8DSI(3),P5DSI(3),P3DSI(3)
    REAL P2NSI(3),P1NSI(3),P8NSI(3),P5NSI(3),P3NSI(3)
    !      Additional local and temporary variables
    REAL XN2DEI,XN1DEI,XN8DEI,XN5DEI,XN3DEI
    REAL XN2NEI,XN1NEI,XN8NEI,XN5NEI,XN3NEI
    REAL DN2DEI,DN1DEI,DN8DEI,DN5DEI,DN3DEI
    REAL DN2NEI,DN1NEI,DN8NEI,DN5NEI,DN3NEI
    REAL XN2DSI,XN1DSI,XN8DSI,XN5DSI,XN3DSI
    REAL XN2NSI,XN1NSI,XN8NSI,XN5NSI,XN3NSI
    REAL DN2DSI,DN1DSI,DN8DSI,DN5DSI,DN3DSI
    REAL DN2NSI,DN1NSI,DN8NSI,DN5NSI,DN3NSI
    REAL MLTTMP
    INTEGER I
    !
    DATA (INVDPQ(I),I=1,13) /-90.0,-75.0,-60.0,-45.0,-30.0,-15.0,&
        0.0, 15.0, 30.0, 45.0, 60.0, 75.0,90.0/
    !      Equinox
    DATA ((P2DE(I,J),I=1,13),J=1,3) /&
        125., 120., 115., 113., 118., 119., 118., 119., 118., 113.,&
        115., 120., 125.,&
        150., 151., 152., 158., 154., 156., 147., 156., 154., 158.,&
        152., 151., 150.,&
        181., 197., 213., 214., 205., 199., 197., 199., 205., 214.,&
        213., 197., 181./
    DATA (CXN2DE(I),I=1,13) /  587.,  466.,  345.,  264.,  355.,&
        335.,  229.,  335.,  355.,  264.,  345.,  466.,  587./
    DATA (CDN2DE(I),I=1,13) /  244.,   93.,  -59., -103.,   57.,&
        170.,   16.,  170.,   57., -103.,  -59.,   93.,  244./
    DATA ((P1DE(I,J),I=1,13),J=1,3) /&
        111., 110., 109., 109., 109., 110., 109., 110., 109., 109.,&
        109., 110., 111.,&
        135., 135., 134., 128., 131., 145., 148., 145., 131., 128.,&
        134., 135., 135.,&
        206., 201., 196., 200., 198., 197., 211., 197., 198., 200.,&
        196., 201., 206./
    DATA (CXN1DE(I),I=1,13) /  929.,  590.,  250.,  375.,  126.,&
        471.,  427.,  471.,  126.,  375.,  250.,  590.,  929./
    DATA (CDN1DE(I),I=1,13) /  -36.,   19.,   75.,   77.,   51.,&
        100.,  105.,  100.,   51.,   77.,   75.,   19.,  -36./
    DATA ((P8DE(I,J),I=1,13),J=1,3) /&
        125., 124., 124., 119., 102.,  89.,  98.,  89., 102., 119.,&
        124., 124., 125.,&
        147., 149., 151., 158., 164., 168., 166., 168., 164., 158.,&
        151., 149., 147.,&
        195., 194., 193., 195., 196., 191., 190., 191., 196., 195.,&
        193., 194., 195./
    DATA (CXN8DE(I),I=1,13) /  159.,   75.,   -9., -151.,  511.,&
        694.,  721.,  694.,  511., -151.,   -9.,   75.,  159./
    DATA (CDN8DE(I),I=1,13) /   53.,   47.,   42.,  -45.,  594.,&
        1002.,  733., 1002.,  594.,  -45.,   42.,   47.,   53./
    DATA ((P5DE(I,J),I=1,13),J=1,3) /&
        109., 102.,  95.,  93.,  95.,  92.,  86.,  92.,  95.,  93.,&
        95., 102., 109.,&
        161., 165., 169., 167., 160., 162., 164., 162., 160., 167.,&
        169., 165., 161.,&
        197., 200., 204., 203., 209., 214., 218., 214., 209., 203.,&
        204., 200., 197./
    DATA (CXN5DE(I),I=1,13) /  703.,  472.,  242., -524., -241.,&
        364.,  532.,  364., -241., -524.,  242.,  472.,  703./
    DATA (CDN5DE(I),I=1,13) /  533.,  416.,  300., -591., -398.,&
        115.,  201.,  115., -398., -591.,  300.,  416.,  533./
    DATA ((P3DE(I,J),I=1,13),J=1,3) /&
        70.,  78.,  86.,  89.,  90.,  92.,  89.,  92.,  90.,  89.,&
        86.,  78.,  70.,&
        159., 155., 152., 153., 152., 147., 143., 147., 152., 153.,&
        152., 155., 159.,&
        212., 212., 212., 208., 208., 207., 205., 207., 208., 208.,&
        212., 212., 212./
    DATA (CXN3DE(I),I=1,13) /  277.,   77., -123., -364., -136.,&
        317.,  411.,  317., -136., -364., -123.,   77.,  277./
    DATA (CDN3DE(I),I=1,13) /  -24.,  -15.,   -6.,  -74., -217.,&
        188.,  269.,  188., -217.,  -74.,   -6.,  -15.,  -24./
    DATA ((P2NE(I,J),I=1,13),J=1,3) /&
        113., 111., 109., 107., 103., 106., 102., 106., 103., 107.,&
        109., 111., 113.,&
        155., 157., 160., 158., 157., 146., 137., 146., 157., 158.,&
        160., 157., 155.,&
        188., 195., 202., 208., 209., 207., 201., 207., 209., 208.,&
        202., 195., 188./
    DATA (CXN2NE(I),I=1,13) /   76.,  134.,  192.,  821.,  801.,&
        583.,  551.,  583.,  801.,  821.,  192.,  134.,   76./
    !       DATA (CDN2NE(I),I=1,13) /  -19.,  -83., -148.,  399.,  289.,
    !         340.,  542.,  340.,  289.,  399., -148.,  -83.,  -19./
    !        equator corrected
    DATA (CDN2NE(I),I=1,13) /  -19.,  -83., -148.,  399.,  289.,&
        340.,  340.,  340.,  289.,  399., -148.,  -83.,  -19./
    DATA ((P1NE(I,J),I=1,13),J=1,3) /&
        112., 111., 109., 108., 109., 110., 109., 110., 109., 108.,&
        109., 111., 112.,&
        132., 132., 133., 131., 134., 143., 143., 143., 134., 131.,&
        133., 132., 132.,&
        220., 211., 201., 195., 196., 204., 213., 204., 196., 195.,&
        201., 211., 220./
    DATA (CXN1NE(I),I=1,13) /  806.,  689.,  572.,  607.,  540.,&
        535.,  443.,  535.,  540.,  607.,  572.,  689.,  806./
    DATA (CDN1NE(I),I=1,13) /  124.,   23.,  -77.,   50.,  128.,&
        120.,   79.,  120.,  128.,   50.,  -77.,   23.,  124./
    DATA ((P8NE(I,J),I=1,13),J=1,3) /&
        124., 124., 124., 123., 119., 108., 110., 108., 119., 123.,&
        124., 124., 124.,&
        149., 149., 149., 149., 155., 164., 170., 164., 155., 149.,&
        149., 149., 149.,&
        195., 195., 194., 193., 194., 195., 194., 195., 194., 193.,&
        194., 195., 195./
    DATA (CXN8NE(I),I=1,13) /   57.,  -17.,  -90.,  -19.,  260.,&
        431.,  417.,  431.,  260.,  -19.,  -90.,  -17.,   57./
    DATA (CDN8NE(I),I=1,13) /   18.,   -7.,  -32.,   31.,  139.,&
        320.,  351.,  320.,  139.,   31.,  -32.,   -7.,   18./
    DATA ((P5NE(I,J),I=1,13),J=1,3) /&
        112., 105.,  98., 100.,  98.,  91.,  90.,  91.,  98., 100.,&
        98., 105., 112.,&
        162., 161., 160., 163., 166., 165., 165., 165., 166., 163.,&
        160., 161., 162.,&
        208., 205., 203., 201., 202., 207., 208., 207., 202., 201.,&
        203., 205., 208./
    DATA (CXN5NE(I),I=1,13) /  575.,  437.,  299.,  198.,  293.,&
        384.,  403.,  384.,  293.,  198.,  299.,  437.,  575./
    DATA (CDN5NE(I),I=1,13) /  353.,  256.,  159.,   58.,  203.,&
        253.,  230.,  253.,  203.,   58.,  159.,  256.,  353./
    DATA ((P3NE(I,J),I=1,13),J=1,3) /&
        72.,  78.,  85.,  90.,  94.,  89.,  88.,  89.,  94.,  90.,&
        85.,  78.,  72.,&
        163., 159., 154., 160., 164., 161., 157., 161., 164., 160.,&
        154., 159., 163.,&
        212., 211., 210., 205., 208., 224., 231., 224., 208., 205.,&
        210., 211., 212./
    DATA (CXN3NE(I),I=1,13) / 1457.,  763.,   68.,  153.,  187.,&
        390.,  364.,  390.,  187.,  153.,   68.,  763., 1457./
    DATA (CDN3NE(I),I=1,13) /  722.,  329.,  -63.,   40.,   31.,&
        102.,  111.,  102.,   31.,   40.,  -63.,  329.,  722./
    !      Solstice
    DATA ((P2DS(I,J),I=1,13),J=1,3) /&
        90.,  90.,  91.,  91.,  98., 105., 112., 119., 125., 124.,&
        120., 126., 131.,&
        155., 156., 156., 161., 163., 158., 152., 155., 154., 147.,&
        152., 148., 145.,&
        205., 202., 199., 191., 195., 206., 212., 210., 206., 205.,&
        203., 201., 199./
    DATA (CXN2DS(I),I=1,13) / -714., -294.,  126.,  546.,  516.,&
        486.,  456.,  426.,  396.,  225.,  366.,  710., 1055./
    DATA (CDN2DS(I),I=1,13) / -732., -357.,   17.,  392.,  327.,&
        262.,  197.,  132.,   67.,  -80.,   62.,  330.,  598./
    DATA ((P1DS(I,J),I=1,13),J=1,3) /&
        105., 107., 108., 112., 111., 111., 112., 113., 113., 113.,&
        114., 116., 118.,&
        125., 127., 130., 132., 135., 134., 135., 139., 134., 133.,&
        135., 136., 137.,&
        189., 193., 198., 211., 218., 202., 199., 200., 206., 213.,&
        217., 224., 231./
    DATA (CXN1DS(I),I=1,13) /  706.,  480.,  255.,   56.,  310.,&
        111.,  164.,  249.,  324.,  629.,  837.,  938., 1038./
    DATA (CDN1DS(I),I=1,13) /   25.,   51.,   77.,   26.,  107.,&
        131.,  118.,  141.,  130.,   68.,   45.,  123.,  202./
    DATA ((P8DS(I,J),I=1,13),J=1,3) /&
        125., 122., 120., 121., 119., 116., 113., 110., 107., 114.,&
        125., 127., 129.,&
        148., 147., 146., 149., 159., 163., 162., 160., 171., 160.,&
        154., 152., 150.,&
        199., 199., 198., 200., 198., 200., 214., 221., 215., 192.,&
        193., 196., 200./
    DATA (CXN8DS(I),I=1,13) /  201.,   47., -106., -130., -106.,&
        26.,  158.,  290.,  422.,  214.,  185.,  224.,  263./
    DATA (CDN8DS(I),I=1,13) /  104.,   63.,   22.,   -3.,   -1.,&
        60.,  121.,  182.,  242.,  170.,   51.,   67.,   84./
    DATA ((P5DS(I,J),I=1,13),J=1,3) /&
        91.,  88.,  86.,  95.,  94.,  88.,  85.,  90.,  95.,  96.,&
        96.,  97.,  98.,&
        165., 167., 168., 150., 159., 161., 161., 159., 158., 158.,&
        145., 149., 154.,&
        189., 191., 194., 201., 204., 200., 196., 193., 191., 196.,&
        204., 201., 199./
    DATA (CXN5DS(I),I=1,13) /-1839.,-1044., -248., -253., -416.,&
        17.,  156.,  118., -110.,  372.,  934.,  895.,  856./
    DATA (CDN5DS(I),I=1,13) /-1603.,-1092., -581., -656., -433.,&
        -166.,   51.,  -29., -325.,  117.,  -36.,  321.,  678./
    DATA ((P3DS(I,J),I=1,13),J=1,3) /&
        97.,  94.,  92.,  94.,  90.,  89.,  90.,  92.,  93.,  91.,&
        95.,  85.,  75.,&
        155., 148., 141., 142., 142., 140., 139., 142., 145., 141.,&
        144., 155., 167.,&
        197., 200., 204., 207., 200., 203., 206., 209., 212., 219.,&
        219., 204., 190./
    DATA (CXN3DS(I),I=1,13) / -894., -797., -700., -604.,  139.,&
        246.,  354.,  462.,  569.,  142.,   81.,  293.,  505./
    DATA (CDN3DS(I),I=1,13) / -740., -577., -414., -140.,   55.,&
        -27.,  110.,   74.,  -10., -122.,   52.,  209.,  366./
    DATA ((P2NS(I,J),I=1,13),J=1,3) /&
        105., 107., 110., 112., 115., 110., 104.,  99.,  95., 103.,&
        117., 127., 136.,&
        149., 146., 144., 147., 143., 139., 138., 143., 152., 154.,&
        154., 148., 142.,&
        198., 200., 201., 206., 211., 210., 209., 200., 196., 197.,&
        205., 205., 206./
    DATA (CXN2NS(I),I=1,13) / -817., -511., -205.,  100.,  406.,&
        312.,  217.,  123.,  640., 1037.,  580.,  677.,  773./
    DATA (CDN2NS(I),I=1,13) /  755.,  684.,  612.,  540.,  469.,&
        191.,  -87., -365., -171., -224., -112.,  146.,  403./
    DATA ((P1NS(I,J),I=1,13),J=1,3) /&
        104., 108., 112., 112., 114., 113., 112., 112., 112., 114.,&
        114., 116., 119.,&
        137., 135., 133., 131., 136., 137., 133., 134., 131., 133.,&
        135., 135., 134.,&
        240., 224., 208., 207., 204., 201., 199., 208., 208., 211.,&
        196., 198., 200./
    DATA (CXN1NS(I),I=1,13) / 1440.,  430., -580.,  201.,  354.,&
        470.,  281.,  329.,  511.,  546.,  741.,  911., 1082./
    DATA (CDN1NS(I),I=1,13) / -236., -256., -276.,  182.,  155.,&
        100.,  128.,  148.,  100.,  -61., -102.,   33.,  169./
    DATA ((P8NS(I,J),I=1,13),J=1,3) /&
        128., 127., 127., 127., 126., 122., 102., 115., 116., 118.,&
        121., 121., 121.,&
        153., 153., 153., 153., 154., 158., 163., 156., 150., 146.,&
        147., 147., 147.,&
        198., 197., 197., 195., 193., 194., 197., 198., 198., 198.,&
        198., 198., 199./
    DATA (CXN8NS(I),I=1,13) /  199.,   -8., -215.,   92.,  275.,&
        284.,  304.,  322.,  284.,  161.,  121.,  200.,  280./
    DATA (CDN8NS(I),I=1,13) /  123.,    1., -121.,   -6.,  151.,&
        146.,  -19.,  169.,  149.,   75.,   22.,   78.,  134./
    DATA ((P5NS(I,J),I=1,13),J=1,3) /&
        85.,  89.,  93., 102.,  95.,  85.,  83.,  86.,  97., 101.,&
        93.,  92.,  90.,&
        166., 163., 160., 167., 168., 167., 165., 167., 169., 164.,&
        157., 162., 166.,&
        217., 207., 196., 183., 193., 194., 197., 205., 209., 205.,&
        205., 201., 198./
    DATA (CXN5NS(I),I=1,13) /  274.,  246.,  218.,   90.,  248.,&
        337.,  370.,  433.,  361.,  461.,  541.,  615.,  689./
    DATA (CDN5NS(I),I=1,13) / -153.,  -61.,   30.,   48.,  169.,&
        241.,  279.,  260.,  187.,  380.,  316.,  436.,  557./
    DATA ((P3NS(I,J),I=1,13),J=1,3) /&
        74.,  80.,  87.,  89.,  95.,  94.,  92.,  91.,  90.,  93.,&
        93.,  87.,  81.,&
        151., 146., 141., 142., 151., 158., 159., 159., 160., 155.,&
        149., 153., 157.,&
        221., 205., 189., 184., 180., 175., 176., 179., 191., 199.,&
        210., 204., 198./
    DATA (CXN3NS(I),I=1,13) /   68.,   34.,    1.,  154.,  151.,&
        178.,  224.,  198.,  220.,  380.,  559.,  228., -104./
    DATA (CDN3NS(I),I=1,13) /   97.,    1.,  -95.,   47.,   37.,&
        112.,   96.,  106.,  129.,  252.,  470.,  220.,  -30./
    !
    DO I=1,13
        TXN2DE(I)=CXN2DE(I)
        TDN2DE(I)=CDN2DE(I)
        TXN1DE(I)=CXN1DE(I)
        TDN1DE(I)=CDN1DE(I)
        TXN8DE(I)=CXN8DE(I)
        TDN8DE(I)=CDN8DE(I)
        TXN5DE(I)=CXN5DE(I)
        TDN5DE(I)=CDN5DE(I)
        TXN3DE(I)=CXN3DE(I)
        TDN3DE(I)=CDN3DE(I)
        TXN2NE(I)=CXN2NE(I)
        TDN2NE(I)=CDN2NE(I)
        TXN1NE(I)=CXN1NE(I)
        TDN1NE(I)=CDN1NE(I)
        TXN8NE(I)=CXN8NE(I)
        TDN8NE(I)=CDN8NE(I)
        TXN5NE(I)=CXN5NE(I)
        TDN5NE(I)=CDN5NE(I)
        TXN3NE(I)=CXN3NE(I)
        TDN3NE(I)=CDN3NE(I)
        TXN2DS(I)=CXN2DS(I)
        TDN2DS(I)=CDN2DS(I)
        TXN1DS(I)=CXN1DS(I)
        TDN1DS(I)=CDN1DS(I)
        TXN8DS(I)=CXN8DS(I)
        TDN8DS(I)=CDN8DS(I)
        TXN5DS(I)=CXN5DS(I)
        TDN5DS(I)=CDN5DS(I)
        TXN3DS(I)=CXN3DS(I)
        TDN3DS(I)=CDN3DS(I)
        TXN2NS(I)=CXN2NS(I)
        TDN2NS(I)=CDN2NS(I)
        TXN1NS(I)=CXN1NS(I)
        TDN1NS(I)=CDN1NS(I)
        TXN8NS(I)=CXN8NS(I)
        TDN8NS(I)=CDN8NS(I)
        TXN5NS(I)=CXN5NS(I)
        TDN5NS(I)=CDN5NS(I)
        TXN3NS(I)=CXN3NS(I)
        TDN3NS(I)=CDN3NS(I)
    end do
    !
    IF (((DDD  >=  265) .AND. (DDD  <  354)) .OR. &
        ((DDD  >=  354) .OR. (DDD  <  79))) THEN
        CALL SWAPEL(13,TXN2DS)
        CALL SWAPEL(13,TDN2DS)
        CALL SWAPEL(13,TXN1DS)
        CALL SWAPEL(13,TDN1DS)
        CALL SWAPEL(13,TXN8DS)
        CALL SWAPEL(13,TDN8DS)
        CALL SWAPEL(13,TXN5DS)
        CALL SWAPEL(13,TDN5DS)
        CALL SWAPEL(13,TXN3DS)
        CALL SWAPEL(13,TDN3DS)
        CALL SWAPEL(13,TXN2NS)
        CALL SWAPEL(13,TDN2NS)
        CALL SWAPEL(13,TXN1NS)
        CALL SWAPEL(13,TDN1NS)
        CALL SWAPEL(13,TXN8NS)
        CALL SWAPEL(13,TDN8NS)
        CALL SWAPEL(13,TXN5NS)
        CALL SWAPEL(13,TDN5NS)
        CALL SWAPEL(13,TXN3NS)
        CALL SWAPEL(13,TDN3NS)
    END IF

    !      interpolated Te values for invdip
    !      Te max-min day equinox
    XN2DEI=INTERP(13,0,TXN2DE,INVDPQ,INVDIP)
    XN1DEI=INTERP(13,0,TXN1DE,INVDPQ,INVDIP)
    XN8DEI=INTERP(13,0,TXN8DE,INVDPQ,INVDIP)
    XN5DEI=INTERP(13,0,TXN5DE,INVDPQ,INVDIP)
    XN3DEI=INTERP(13,0,TXN3DE,INVDPQ,INVDIP)
    !      Te max-min night equinox
    XN2NEI=INTERP(13,0,TXN2NE,INVDPQ,INVDIP)
    XN1NEI=INTERP(13,0,TXN1NE,INVDPQ,INVDIP)
    XN8NEI=INTERP(13,0,TXN8NE,INVDPQ,INVDIP)
    XN5NEI=INTERP(13,0,TXN5NE,INVDPQ,INVDIP)
    XN3NEI=INTERP(13,0,TXN3NE,INVDPQ,INVDIP)
    !      Te med-min day equinox
    DN2DEI=INTERP(13,0,TDN2DE,INVDPQ,INVDIP)
    DN1DEI=INTERP(13,0,TDN1DE,INVDPQ,INVDIP)
    DN8DEI=INTERP(13,0,TDN8DE,INVDPQ,INVDIP)
    DN5DEI=INTERP(13,0,TDN5DE,INVDPQ,INVDIP)
    DN3DEI=INTERP(13,0,TDN3DE,INVDPQ,INVDIP)
    !      Te med-min night equinox
    DN2NEI=INTERP(13,0,TDN2NE,INVDPQ,INVDIP)
    DN1NEI=INTERP(13,0,TDN1NE,INVDPQ,INVDIP)
    DN8NEI=INTERP(13,0,TDN8NE,INVDPQ,INVDIP)
    DN5NEI=INTERP(13,0,TDN5NE,INVDPQ,INVDIP)
    DN3NEI=INTERP(13,0,TDN3NE,INVDPQ,INVDIP)
    !
    !      Te max-min day solstice
    XN2DSI=INTERP(13,0,TXN2DS,INVDPQ,INVDIP)
    XN1DSI=INTERP(13,0,TXN1DS,INVDPQ,INVDIP)
    XN8DSI=INTERP(13,0,TXN8DS,INVDPQ,INVDIP)
    XN5DSI=INTERP(13,0,TXN5DS,INVDPQ,INVDIP)
    XN3DSI=INTERP(13,0,TXN3DS,INVDPQ,INVDIP)
    !      Te max-min night solstice
    XN2NSI=INTERP(13,0,TXN2NS,INVDPQ,INVDIP)
    XN1NSI=INTERP(13,0,TXN1NS,INVDPQ,INVDIP)
    XN8NSI=INTERP(13,0,TXN8NS,INVDPQ,INVDIP)
    XN5NSI=INTERP(13,0,TXN5NS,INVDPQ,INVDIP)
    XN3NSI=INTERP(13,0,TXN3NS,INVDPQ,INVDIP)
    !      Te med-min day solstice
    DN2DSI=INTERP(13,0,TDN2DS,INVDPQ,INVDIP)
    DN1DSI=INTERP(13,0,TDN1DS,INVDPQ,INVDIP)
    DN8DSI=INTERP(13,0,TDN8DS,INVDPQ,INVDIP)
    DN5DSI=INTERP(13,0,TDN5DS,INVDPQ,INVDIP)
    DN3DSI=INTERP(13,0,TDN3DS,INVDPQ,INVDIP)
    !      Te med-min night solstice
    DN2NSI=INTERP(13,0,TDN2NS,INVDPQ,INVDIP)
    DN1NSI=INTERP(13,0,TDN1NS,INVDPQ,INVDIP)
    DN8NSI=INTERP(13,0,TDN8NS,INVDPQ,INVDIP)
    DN5NSI=INTERP(13,0,TDN5NS,INVDPQ,INVDIP)
    DN3NSI=INTERP(13,0,TDN3NS,INVDPQ,INVDIP)
    DO I=1,3
        P2DEI(I)=INTERP(13,1,P2DE(1,I),INVDPQ,INVDIP)
        P2NEI(I)=INTERP(13,1,P2NE(1,I),INVDPQ,INVDIP)
        P1DEI(I)=INTERP(13,1,P1DE(1,I),INVDPQ,INVDIP)
        P1NEI(I)=INTERP(13,1,P1NE(1,I),INVDPQ,INVDIP)
        P8DEI(I)=INTERP(13,1,P8DE(1,I),INVDPQ,INVDIP)
        P8NEI(I)=INTERP(13,1,P8NE(1,I),INVDPQ,INVDIP)
        P5DEI(I)=INTERP(13,1,P5DE(1,I),INVDPQ,INVDIP)
        P5NEI(I)=INTERP(13,1,P5NE(1,I),INVDPQ,INVDIP)
        P3DEI(I)=INTERP(13,1,P3DE(1,I),INVDPQ,INVDIP)
        P3NEI(I)=INTERP(13,1,P3NE(1,I),INVDPQ,INVDIP)

        P2DSI(I)=INTERP(13,1,P2DS(1,I),INVDPQ,INVDIP)
        P2NSI(I)=INTERP(13,1,P2NS(1,I),INVDPQ,INVDIP)
        P1DSI(I)=INTERP(13,1,P1DS(1,I),INVDPQ,INVDIP)
        P1NSI(I)=INTERP(13,1,P1NS(1,I),INVDPQ,INVDIP)
        P8DSI(I)=INTERP(13,1,P8DS(1,I),INVDPQ,INVDIP)
        P8NSI(I)=INTERP(13,1,P8NS(1,I),INVDPQ,INVDIP)
        P5DSI(I)=INTERP(13,1,P5DS(1,I),INVDPQ,INVDIP)
        P5NSI(I)=INTERP(13,1,P5NS(1,I),INVDPQ,INVDIP)
        P3DSI(I)=INTERP(13,1,P3DS(1,I),INVDPQ,INVDIP)
        P3NSI(I)=INTERP(13,1,P3NS(1,I),INVDPQ,INVDIP)
    end do
    MLTTMP=MLT-1
    IF (MLTTMP  <  0) MLTTMP=MLTTMP+24.0
    MLTRAD=MLTTMP/24.0*2*3.1415927
    IF (((DDD  >=  79) .AND. (DDD  <  171)) .OR. &
        ((DDD  >=  265) .AND. (DDD  <  354))) THEN
        !      Equinox
        CALL TPCAS(MLTRAD,PF107,P2000A,&
            XN2DEI,DN2DEI,P2DEI,XN2NEI,DN2NEI,P2NEI,TP200A)
        CALL TPCAS(MLTRAD,PF107,P1400A,&
            XN1DEI,DN1DEI,P1DEI,XN1NEI,DN1NEI,P1NEI,TP140A)
        CALL TPCAS(MLTRAD,PF107,P850A,&
            XN8DEI,DN8DEI,P8DEI,XN8NEI,DN8NEI,P8NEI,TP850A)
        CALL TPCAS(MLTRAD,PF107,P550A,&
            XN5DEI,DN5DEI,P5DEI,XN5NEI,DN5NEI,P5NEI,TP550A)
        CALL TPCAS(MLTRAD,PF107,P350A,&
            XN3DEI,DN3DEI,P3DEI,XN3NEI,DN3NEI,P3NEI,TP350A)
        !       Solstice
        CALL TPCAS(MLTRAD,PF107,P2000B,&
            XN2DSI,DN2DSI,P2DSI,XN2NSI,DN2NSI,P2NSI,TP200B)
        CALL TPCAS(MLTRAD,PF107,P1400B,&
            XN1DSI,DN1DSI,P1DSI,XN1NSI,DN1NSI,P1NSI,TP140B)
        CALL TPCAS(MLTRAD,PF107,P850B,&
            XN8DSI,DN8DSI,P8DSI,XN8NSI,DN8NSI,P8NSI,TP850B)
        CALL TPCAS(MLTRAD,PF107,P550B,&
            XN5DSI,DN5DSI,P5DSI,XN5NSI,DN5NSI,P5NSI,TP550B)
        CALL TPCAS(MLTRAD,PF107,P350B,&
            XN3DSI,DN3DSI,P3DSI,XN3NSI,DN3NSI,P3NSI,TP350B)
    END IF
    IF (((DDD  >=  171) .AND. (DDD  <  265)) .OR. &
        ((DDD  >=  354) .OR. (DDD  <  79)))  THEN
        !       Solstice
        CALL TPCAS(MLTRAD,PF107,P2000A,&
            XN2DSI,DN2DSI,P2DSI,XN2NSI,DN2NSI,P2NSI,TP200A)
        CALL TPCAS(MLTRAD,PF107,P1400A,&
            XN1DSI,DN1DSI,P1DSI,XN1NSI,DN1NSI,P1NSI,TP140A)
        CALL TPCAS(MLTRAD,PF107,P850A,&
            XN8DSI,DN8DSI,P8DSI,XN8NSI,DN8NSI,P8NSI,TP850A)
        CALL TPCAS(MLTRAD,PF107,P550A,&
            XN5DSI,DN5DSI,P5DSI,XN5NSI,DN5NSI,P5NSI,TP550A)
        CALL TPCAS(MLTRAD,PF107,P350A,&
            XN3DSI,DN3DSI,P3DSI,XN3NSI,DN3NSI,P3NSI,TP350A)
        !      Equinox
        CALL TPCAS(MLTRAD,PF107,P2000B,&
            XN2DEI,DN2DEI,P2DEI,XN2NEI,DN2NEI,P2NEI,TP200B)
        CALL TPCAS(MLTRAD,PF107,P1400B,&
            XN1DEI,DN1DEI,P1DEI,XN1NEI,DN1NEI,P1NEI,TP140B)
        CALL TPCAS(MLTRAD,PF107,P850B,&
            XN8DEI,DN8DEI,P8DEI,XN8NEI,DN8NEI,P8NEI,TP850B)
        CALL TPCAS(MLTRAD,PF107,P550B,&
            XN5DEI,DN5DEI,P5DEI,XN5NEI,DN5NEI,P5NEI,TP550B)
        CALL TPCAS(MLTRAD,PF107,P350B,&
            XN3DEI,DN3DEI,P3DEI,XN3NEI,DN3NEI,P3NEI,TP350B)
    END IF
    RETURN
END
!
!
SUBROUTINE TEBA(DIPL,SLT,NS,TE)
    ! CALCULATES ELECTRON TEMPERATURES TE(1) TO TE(4) AT ALTITUDES
    ! 300, 400, 1400 AND 3000 KM FOR DIP-LATITUDE DIPL/DEG AND
    ! LOCAL SOLAR TIME SLT/H USING THE BRACE-THEIS-MODELS (J. ATMOS.
    ! TERR. PHYS. 43, 1317, 1981); NS IS SEASON IN NORTHERN
    ! HEMISOHERE: IS=1 SPRING, IS=2 SUMMER ....
    ! ALSO CALCULATED ARE THE TEMPERATURES AT 400 KM ALTITUDE FOR
    ! MIDNIGHT (TE(5)) AND NOON (TE(6)).
    DIMENSION C(4,2,81),A(82),TE(6)
    COMMON    /CONST/UMR,PI      /const1/humr,dumr
    DATA (C(1,1,J),J=1,81)/                      &
        .3100E1,-.3215E-2,.2440E+0,-.4613E-3,-.1711E-1,.2605E-1,                  &
        -.9546E-1,.1794E-1,.1270E-1,.2791E-1,.1536E-1,-.6629E-2,                  &
        -.3616E-2,.1229E-1,.4147E-3,.1447E-2,-.4453E-3,-.1853,                    &
        -.1245E-1,-.3675E-1,.4965E-2,.5460E-2,.8117E-2,-.1002E-1,                 &
        .5466E-3,-.3087E-1,-.3435E-2,-.1107E-3,.2199E-2,.4115E-3,                 &
        .6061E-3,.2916E-3,-.6584E-1,.4729E-2,-.1523E-2,.6689E-3,                  &
        .1031E-2,.5398E-3,-.1924E-2,-.4565E-1,.7244E-2,-.8543E-4,                 &
        .1052E-2,-.6696E-3,-.7492E-3,.4405E-1,.3047E-2,.2858E-2,                  &
        -.1465E-3,.1195E-2,-.1024E-3,.4582E-1,.8749E-3,.3011E-3,                  &
        .4473E-3,-.2782E-3,.4911E-1,-.1016E-1,.27E-2,-.9304E-3,                   &
        -.1202E-2,.2210E-1,.2566E-2,-.122E-3,.3987E-3,-.5744E-1,                  &
        .4408E-2,-.3497E-2,.83E-3,-.3536E-1,-.8813E-2,.2423E-2,                   &
        -.2994E-1,-.1929E-2,-.5268E-3,-.2228E-1,.3385E-2,                         &
        .413E-1,.4876E-2,.2692E-1,.1684E-2/
    DATA (C(1,2,J),J=1,81)/.313654E1,.6796E-2,.181413,.8564E-1,               &
        -.32856E-1,-.3508E-2,-.1438E-1,-.2454E-1,.2745E-2,.5284E-1,               &
        .1136E-1,-.1956E-1,-.5805E-2,.2801E-2,-.1211E-2,.4127E-2,                 &
        .2909E-2,-.25751,-.37915E-2,-.136E-1,-.13225E-1,.1202E-1,                 &
        .1256E-1,-.12165E-1,.1326E-1,-.7123E-1,.5793E-3,.1537E-2,                 &
        .6914E-2,-.4173E-2,.1052E-3,-.5765E-3,-.4041E-1,-.1752E-2,                &
        -.542E-2,-.684E-2,.8921E-3,-.2228E-2,.1428E-2,.6635E-2,-.48045E-2,        &
        -.1659E-2,-.9341E-3,.223E-3,-.9995E-3,.4285E-1,-.5211E-3,                 &
        -.3293E-2,.179E-2,.6435E-3,-.1891E-3,.3844E-1,.359E-2,-.8139E-3,          &
        -.1996E-2,.2398E-3,.2938E-1,.761E-2,.347655E-2,.1707E-2,.2769E-3,         &
        -.157E-1,.983E-3,-.6532E-3,.929E-4,-.2506E-1,.4681E-2,.1461E-2,           &
        -.3757E-5,-.9728E-2,.2315E-2,.6377E-3,-.1705E-1,.2767E-2,                 &
        -.6992E-3,-.115E-1,-.1644E-2,.3355E-2,-.4326E-2,.2035E-1,.2985E-1/
    DATA (C(2,1,J),J=1,81)/.3136E1,.6498E-2,.2289,.1859E-1,-.3328E-1,         &
        -.4889E-2,-.3054E-1,-.1773E-1,-.1728E-1,.6555E-1,.1775E-1,                &
        -.2488E-1,-.9498E-2,.1493E-1,.281E-2,.2406E-2,.5436E-2,-.2115,            &
        .7007E-2,-.5129E-1,-.7327E-2,.2402E-1,.4772E-2,-.7374E-2,                 &
        -.3835E-3,-.5013E-1,.2866E-2,.2216E-2,.2412E-3,.2094E-2,.122E-2           &
        ,-.1703E-3,-.1082,-.4992E-2,-.4065E-2,.3615E-2,-.2738E-2,                 &
        -.7177E-3,.2173E-3,-.4373E-1,-.375E-2,.5507E-2,-.1567E-2,                 &
        -.1458E-2,-.7397E-3,.7903E-1,.4131E-2,.3714E-2,.1073E-2,                  &
        -.8991E-3,.2976E-3,.2623E-1,.2344E-2,.5608E-3,.4124E-3,.1509E-3,          &
        .5103E-1,.345E-2,.1283E-2,.7238E-3,-.3464E-4,.1663E-1,-.1644E-2,          &
        -.71E-3,.5281E-3,-.2729E-1,.3556E-2,-.3391E-2,-.1787E-3,.2154E-2,         &
        .6476E-2,-.8282E-3,-.2361E-1,.9557E-3,.3205E-3,-.2301E-1,                 &
        -.854E-3,-.1126E-1,-.2323E-2,-.8582E-2,.2683E-1/
    DATA (C(2,2,J),J=1,81)/.3144E1,.8571E-2,.2539,.6937E-1,-.1667E-1,         &
        .2249E-1,-.4162E-1,.1201E-1,.2435E-1,.5232E-1,.2521E-1,-.199E-1,          &
        -.7671E-2,.1264E-1,-.1551E-2,-.1928E-2,.3652E-2,-.2019,.5697E-2,          &
        -.3159E-1,-.1451E-1,.2868E-1,.1377E-1,-.4383E-2,.1172E-1,                 &
        -.5683E-1,.3593E-2,.3571E-2,.3282E-2,.1732E-2,-.4921E-3,-.1165E-2         &
        ,-.1066,-.1892E-1,.357E-2,-.8631E-3,-.1876E-2,-.8414E-4,.2356E-2,         &
        -.4259E-1,-.322E-2,.4641E-2,.6223E-3,-.168E-2,-.1243E-3,.7393E-1,         &
        -.3143E-2,-.2362E-2,.1235E-2,-.1551E-2,.2099E-3,.2299E-1,.5301E-2         &
        ,-.4306E-2,-.1303E-2,.7687E-5,.5305E-1,.6642E-2,-.1686E-2,                &
        .1048E-2,.5958E-3,.4341E-1,-.8819E-4,-.333E-3,-.2158E-3,-.4106E-1         &
        ,.4191E-2,.2045E-2,-.1437E-3,-.1803E-1,-.8072E-3,-.424E-3,                &
        -.26E-1,-.2329E-2,.5949E-3,-.1371E-1,-.2188E-2,.1788E-1,                  &
        .6405E-3,.5977E-2,.1333E-1/
    DATA (C(3,1,J),J=1,81)/.3372E1,.1006E-1,.1436,.2023E-2,-.5166E-1,         &
        .9606E-2,-.5596E-1,.4914E-3,-.3124E-2,-.4713E-1,-.7371E-2,                &
        -.4823E-2,-.2213E-2,.6569E-2,-.1962E-3,.3309E-3,-.3908E-3,                &
        -.2836,.7829E-2,.1175E-1,.9919E-3,.6589E-2,.2045E-2,-.7346E-2             &
        ,-.89E-3,-.347E-1,-.4977E-2,.147E-2,-.2823E-5,.6465E-3,                   &
        -.1448E-3,.1401E-2,-.8988E-1,-.3293E-4,-.1848E-2,.4439E-3,                &
        -.1263E-2,.317E-3,-.6227E-3,.1721E-1,-.199E-2,-.4627E-3,                  &
        .2897E-5,-.5454E-3,.3385E-3,.8432E-1,-.1951E-2,.1487E-2,                  &
        .1042E-2,-.4788E-3,-.1276E-3,.2373E-1,.2409E-2,.5263E-3,                  &
        .1301E-2,-.4177E-3,.3974E-1,.1418E-3,-.1048E-2,-.2982E-3,                 &
        -.3396E-4,.131E-1,.1413E-2,-.1373E-3,.2638E-3,-.4171E-1,                  &
        -.5932E-3,-.7523E-3,-.6883E-3,-.2355E-1,.5695E-3,-.2219E-4,               &
        -.2301E-1,-.9962E-4,-.6761E-3,.204E-2,-.5479E-3,.2591E-1,                 &
        -.2425E-2,.1583E-1,.9577E-2/
    DATA (C(3,2,J),J=1,81)/.3367E1,.1038E-1,.1407,.3622E-1,-.3144E-1,         &
        .112E-1,-.5674E-1,.3219E-1,.1288E-2,-.5799E-1,-.4609E-2,                  &
        .3252E-2,-.2859E-3,.1226E-1,-.4539E-2,.1310E-2,-.5603E-3,                 &
        -.311,-.1268E-2,.1539E-1,.3146E-2,.7787E-2,-.143E-2,-.482E-2              &
        ,.2924E-2,-.9981E-1,-.7838E-2,-.1663E-3,.4769E-3,.4148E-2,                &
        -.1008E-2,-.979E-3,-.9049E-1,-.2994E-2,-.6748E-2,-.9889E-3,               &
        .1488E-2,-.1154E-2,-.8412E-4,-.1302E-1,-.4859E-2,-.7172E-3,               &
        -.9401E-3,.9101E-3,-.1735E-3,.7055E-1,.6398E-2,-.3103E-2,                 &
        -.938E-3,-.4E-3,-.1165E-2,.2713E-1,-.1654E-2,.2781E-2,                    &
        -.5215E-5,.2258E-3,.5022E-1,.95E-2,.4147E-3,.3499E-3,                     &
        -.6097E-3,.4118E-1,.6556E-2,.3793E-2,-.1226E-3,-.2517E-1,                 &
        .1491E-3,.1075E-2,.4531E-3,-.9012E-2,.3343E-2,.3431E-2,                   &
        -.2519E-1,.3793E-4,.5973E-3,-.1423E-1,-.132E-2,-.6048E-2,                 &
        -.5005E-2,-.115E-1,.2574E-1/
    DATA (C(4,1,J),J=1,81)/.3574E1,.0,.7537E-1,.0,-.8459E-1,                  &
        0.,-.294E-1,0.,.4547E-1,-.5321E-1,0.,.4328E-2,0.,.6022E-2,                &
        .0,-.9168E-3,.0,-.1768,.0,.294E-1,.0,.5902E-3,.0,-.9047E-2,               &
        .0,-.6555E-1,.0,-.1033E-2,.0,.1674E-2,.0,.2802E-3,-.6786E-1               &
        ,.0,.4193E-2,.0,-.6448E-3,.0,.9277E-3,-.1634E-1,.0,-.2531E-2              &
        ,.0,.193E-4,.0,.528E-1,.0,.2438E-2,.0,-.5292E-3,.0,.1555E-1               &
        ,.0,-.3259E-2,.0,-.5998E-3,.3168E-1,.0,.2382E-2,.0,-.4078E-3              &
        ,.2312E-1,.0,.1481E-3,.0,-.1885E-1,.0,.1144E-2,.0,-.9952E-2               &
        ,.0,-.551E-3,-.202E-1,.0,-.7283E-4,-.1272E-1,.0,.2224E-2,                 &
        .0,-.251E-2,.2434E-1/
    DATA (C(4,2,J),J=1,81)/.3574E1,-.5639E-2,.7094E-1,                        &
        -.3347E-1,-.861E-1,-.2877E-1,-.3154E-1,-.2847E-2,.1235E-1,                &
        -.5966E-1,-.3236E-2,.3795E-3,-.8634E-3,.3377E-2,-.1071E-3,                &
        -.2151E-2,-.4057E-3,-.1783,.126E-1,.2835E-1,-.242E-2,                     &
        .3002E-2,-.4684E-2,-.6756E-2,-.7493E-3,-.6147E-1,-.5636E-2                &
        ,-.1234E-2,-.1613E-2,-.6353E-4,-.2503E-3,-.1729E-3,-.7148E-1              &
        ,.5326E-2,.4006E-2,.6484E-3,-.1046E-3,-.6034E-3,-.9435E-3,                &
        -.2385E-2,.6853E-2,.151E-2,.1319E-2,.9049E-4,-.1999E-3,                   &
        .3976E-1,.2802E-2,-.103E-2,.5599E-3,-.4791E-3,-.846E-4,                   &
        .2683E-1,.427E-2,.5911E-3,.2987E-3,-.208E-3,.1396E-1,                     &
        -.1922E-2,-.1063E-2,.3803E-3,.1343E-3,.1771E-1,-.1038E-2,                 &
        -.4645E-3,-.2481E-3,-.2251E-1,-.29E-2,-.3977E-3,-.516E-3,                 &
        -.8079E-2,-.1528E-2,.306E-3,-.1582E-1,-.8536E-3,.1565E-3,                 &
        -.1252E-1,.2319E-3,.4311E-2,.1024E-2,.1296E-5,.179E-1/

    IF(NS < 3) THEN
        IS=NS
    ELSE IF(NS > 3) THEN
        IS=2
        DIPL=-DIPL
    ELSE
        IS=1
    ENDIF
    COLAT=UMR*(90.-DIPL)
    AZ=humr*SLT
    CALL SPHARM(A,8,8,COLAT,AZ)
    IF(IS == 2) THEN
        KEND=3
    ELSE
        KEND=4
    ENDIF
    DO K=1,KEND
        STE=0.
        DO I=1,81
            STE=STE+A(I)*C(K,IS,I)
        end do
        TE(K)=10.**STE
    end do
    IF(IS == 2) THEN
        DIPL=-DIPL
        COLAT=UMR*(90.-DIPL)
        CALL SPHARM(A,8,8,COLAT,AZ)
        STE=0.
        DO I=1,81
            STE=STE+A(I)*C(4,2,I)
        end do
        TE(4)=10.**STE
    ENDIF
    !---------- TEMPERATURE AT 400KM AT MIDNIGHT AND NOON
    DO J=1,2
        STE=0.
        AZ=humr*(J-1)*12.
        CALL SPHARM(A,8,8,COLAT,AZ)
        DO I=1,81
            STE=STE+A(I)*C(2,IS,I)
        end do
        TE(J+4)=10.**STE
    end do
    RETURN
END
!
!
SUBROUTINE SPHARM(C,L,M,COLAT,AZ)
    ! CALCULATES THE COEFFICIENTS OF THE SPHERICAL HARMONIC
    ! EXPANSION THAT WAS USED FOR THE BRACE-THEIS-MODELS.
    DIMENSION C(82)
    C(1)=1.
    K=2
    X=COS(COLAT)
    C(K)=X
    K=K+1
    DO I=2,L
        C(K)=((2*I-1)*X*C(K-1)-(I-1)*C(K-2))/I
        K=K+1
    end do
    Y=SIN(COLAT)
    DO MT=1,M
        CAZ=COS(MT*AZ)
        SAZ=SIN(MT*AZ)
        C(K)=Y**MT
        K=K+1
        IF(MT == L) GOTO 16
        C(K)=C(K-1)*X*(2*MT+1)
        K=K+1
        IF((MT+1) == L) GOTO 16
        DO I=2+MT,L
            C(K)=((2*I-1)*X*C(K-1)-(I+MT-1)*C(K-2))/(I-MT)
            K=K+1
        end do
        16    N=L-MT+1
        DO I=1,N
            C(K)=C(K-N)*CAZ
            C(K-N)=C(K-N)*SAZ
            K=K+1
        end do
    end do
    RETURN
END
!
!
REAL FUNCTION ELTE(H)
    !----------------------------------------------------------------
    ! ELECTRON TEMPERATURE PROFILE BASED ON THE TEMPERATURES AT 7 FIXED
    ! HEIGHTS (AH(7)) AND THE TEMPERATURE GRADIENTS BETWEEN THESE THESE
    ! HEIGHTS (ST(6)) GIVEN IN THE COMMON BLOCK. ATE1 IS THE TEMPERATURE
    ! AT THE STARTING HEIGHT 120 KM. D(5) DEFINE THE TRANSITION SPAN FROM
    ! ONE CONSTANT GRADIENT REGION TO THE NEXT.
    !----------------------------------------------------------------
    COMMON /BLOTE/AH(7),ATE1,ST(6),D(5)
    !
    SUM=ATE1+ST(1)*(H-AH(1))
    DO I=1,5
        aa = eptr(h    ,d(i),ah(i+1))
        bb = eptr(ah(1),d(i),ah(i+1))
        SUM=SUM+(ST(I+1)-ST(I))*(AA-BB)*D(I)
    end do
    ELTE=SUM
    RETURN
END
!
!
FUNCTION TEDE(H,DEN,COV)
    ! ELECTRON TEMEPERATURE MODEL AFTER BRACE,THEIS .
    ! FOR NEG. COV THE MEAN COV-INDEX (3 SOLAR ROT.) IS EXPECTED.
    ! DEN IS THE ELECTRON DENSITY IN M-3.
    Y=1051.+(17.01*H-2746.)*                     &
        EXP(-5.122E-4*H+(6.094E-12-3.353E-14*H)*DEN)
    ACOV=ABS(COV)
    YC=1.+(.117+2.02E-3*ACOV)/(1.+EXP(-(ACOV-102.5)/5.))
    IF(COV < 0.)   &
        YC=1.+(.123+1.69E-3*ACOV)/(1.+EXP(-(ACOV-115.)/10.))
    TEDE=Y*YC
    RETURN
END
!
!
!*************************************************************
!**************** ION TEMPERATURE ****************************
!*************************************************************
!
!
REAL FUNCTION TI(H)
    !----------------------------------------------------------------
    ! ION TEMPERATURE FOR HEIGHTS NOT GREATER 1000 KM AND NOT LESS HS
    ! EXPLANATION SEE FUNCTION RPID.
    !----------------------------------------------------------------
    REAL              MM
    COMMON  /BLOCK8/  HS,TNHS,XSM(4),MM(5),G(4),M
    SUM=MM(1)*(H-HS)+TNHS
    DO I=1,M-1
        aa = eptr(h ,g(i),xsm(i))
        bb = eptr(hs,g(i),xsm(i))
        SUM=SUM+(MM(I+1)-MM(I))*(AA-BB)*G(I)
    end do
    TI=SUM
    RETURN
END
!
